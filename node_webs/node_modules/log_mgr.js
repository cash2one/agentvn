//-------------------------------------------------------------------------------------------------------
// log_mgr.js
//-------------------------------------------------------------------------------------------------------
/*
功能：  写日志：1绑定2解绑3封停4解封5修改密码6强制下线
参数：  account: 账号
响应：  0、成功并返回角色信息
        1、操作失败
*/
exports.add_applog = function(account, appid, type, content) {  
    var db      = ms.db.mssql['ShangYoo_Log']  
    var sp_name = 'cp_UserAppLog_AddRecord'

    if (!db) {        
        console.error('db not connected')
        return
    }

    var args = [ account, appid, type, content]
    db.exec_sp(sp_name, args, function(err, rows, output, ret) {
        if (err) {
            console.error(err)
            return
        }
        
        if( ret<=0 ){     
            console.error('write log error')
            return
        }        
    })
}
//-------------------------------------------------------------------------------------------------------
/*
功能：  记录封停、解封游戏账号的日记记录
参数：  userid:  账号ID
        account: 账号
        optype：操作类型：1客服封停  2客服解封  27自己封停  28自己解封
        isok：结果：true成功  false失败
响应：  0、成功并返回角色信息
        1、操作失败
*/
exports.add_lockgameaccountlog = function(userid, account, optype, isok){
    var db      = ms.db.mssql['Admin_Service']  
    var sp_name = 'cp_LockGameAccount_AddRecord'

    if (!db) {        
        console.error('db not connected')
        return
    }

    var date = ms.u2.date_to_ms_datetime(new Date(), 'tds')
    var args = [ userid, account, optype, 0, isok, ' ', 0, ' ', ' ', date , 0, 1]
    db.exec_sp(sp_name, args, function(err, rows, output, ret) {
        if (err) {
            console.error(err)
            return
        } 
    })
}

//-------------------------------------------------------------------------------------------------------
/*
功能：  记录操作日志记录
参数：  adminid：客服管理员ID
        adminname：客服管理员名称
        ip:ip地址
        userid:  账号ID
        account: 账号
        opdec：描述内容
        optype：操作类型：1客服封停  2客服解封  27自己封停  28自己解封
        
响应：  0、成功并返回角色信息
        1、操作失败
*/
exports.add_lockoperatelog = function(adminid, adminname, ip, userid, account, opdec,optype){
    var db      = ms.db.mssql['ShangYoo_Log'] 
    var sp_name = 'cp_OperateLog_AddRecord'

    if (!db) {        
        console.error('db not connected')
        return
    }

    var date = ms.u2.date_to_ms_datetime(new Date(), 'tds')
    var args = [ adminid, adminname, date, ip, userid, account, opdec, optype ]
    db.exec_sp(sp_name, args, function(err, rows, output, ret) {
        if (err) {
            console.error(err)
            return
        } 
    })
}

//-------------------------------------------------------------------------------------------------------
/*
功能：  记录修改密码记录
参数： 
        userid:  账号ID
        account: 账号
        oldpswd：旧密码
        newpswd：新密码
        gameid：游戏ID
        serverid：服务器ID
        ip:ip地址
        
响应：  0、成功并返回角色信息
        1、操作失败
*/
exports.add_changepasswordlog = function(userid, account, oldpswd, newpswd, gameid, serverid, ip){
    var db      = ms.db.mssql['ShangYoo_Log'] 
    var sp_name = 'cp_PasswordLog_AddRecord'

    if (!db) {        
        console.error('db not connected')
        return
    }

    var date = ms.u2.date_to_ms_datetime(new Date(), 'tds')
    var args = [ userid, account, oldpswd, newpswd, gameid, serverid, ip, date ]
    db.exec_sp(sp_name, args, function(err, rows, output, ret) {
        if (err) {
            console.error(err)
            return
        } 
    })
}

//-------------------------------------------------------------------------------------------------------