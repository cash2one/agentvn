//--------------------------------------------------------------------------------------------------------
// persistence.js
//--------------------------------------------------------------------------------------------------------
var mongodb = require('mongo_interface')
//--------------------------------------------------------------------------------------------------------
var ip       =  "127.0.0.1"
var port     =  27017
var db_name  =  "syyx_persistence"
var user     =  'root'
var password =  '123456'
var db_conn  =  null
//--------------------------------------------------------------------------------------------------------
exports.init = function(cb) {
    var args = { 
                 ip       : ip , 
                 port     : port,   
                 db_name  : db_name,
                 user     : user,
		 password : password,						
		}		

    mongodb.open(args, function(err, db) {
        if(!err) {
            db_conn = db
        }
        
        cb(err)
    })            
}
//--------------------------------------------------------------------------------------------------------
exports.save = function(col_name, data, cb) {
    mongodb.save(db_conn, db_name, col_name, data, cb)
}
//--------------------------------------------------------------------------------------------------------
exports.find = function(col_name, selector, options, cb) {
    mongodb.find(db_conn, db_name, col_name, selector, options, cb)
}
//--------------------------------------------------------------------------------------------------------
exports.findOne = function(col_name, selector, options, cb) {
    mongodb.findOne(db_conn, db_name, col_name, selector, options, cb)
}
//--------------------------------------------------------------------------------------------------------
exports.update = function(col_name, selector, document, cb) {
    mongodb.update(db_conn, db_name, col_name, selector, document, cb)
}
//--------------------------------------------------------------------------------------------------------
exports.remove = function(col_name, selector, cb) {
    mongodb.remove(db_conn, db_name, col_name, selector, cb)
}
//--------------------------------------------------------------------------------------------------------
exports.ObjectID = function(id) {
    return mongodb.ObjectID(id)
}
//--------------------------------------------------------------------------------------------------------
exports.shutdown = function(cb) {
    if(db_conn) {
        var admin = db_conn.db('admin')
        
        admin.command({shutdown : 1}, function(err, result) {
            cb()
            return
        })       
    }

    cb()
}
//--------------------------------------------------------------------------------------------------------
