//--------------------------------------------------------------------------------------------------------
var http = require('http')
var url = require('url')
var querystring = require('querystring')
//--------------------------------------------------------------------------------------------------------
exports.get = function(url_str, data, cb, type) {
    http_request('GET', url_str, data, cb, type)
}
//--------------------------------------------------------------------------------------------------------
exports.post = function(url_str, data, cb, type) {
    http_request('POST', url_str, data, cb, type)
}
//--------------------------------------------------------------------------------------------------------
var http_request = function(method, url_str, data, cb, type) {
    var url_info = url.parse(url_str)  
    
    var options  = {}
    options.hostname = url_info.hostname
    options.path     = url_info.path
    options.port     = url_info.port
    options.method   = method
    
    if(method == 'POST') {
        options.headers  =  { "Content-Type" : "application/x-www-form-urlencoded" }
    }

    if(typeof data == 'function') {
        type =  cb  
        cb   = data
        data = null
    }
    
    if(data) {
        var query_string = querystring.stringify(data)
    }

    if(method == 'GET' && query_string) {
        options.path += '?' + query_string
    }

    console.log(options)
    var req = http.request(options, function(res) {
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            if(type && type.toLowerCase() == 'json') {
                chunk  =  JSON.parse(chunk)
            }

            if(type && type.toLowerCase() == 'string') {
                chunk  =  JSON.stringify(chunk)
            }
        
            cb(chunk)
        })
    })

    console.log(query_string)
    if(method == 'POST') {
        req.write(query_string)
    }

    req.end()
}
//--------------------------------------------------------------------------------------------------------