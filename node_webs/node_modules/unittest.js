//--------------------------------------------------------------------------------------------------------
// unittest.js
//--------------------------------------------------------------------------------------------------------
var assert = require('assert')
//--------------------------------------------------------------------------------------------------------
exports.ok = assert.ok
//--------------------------------------------------------------------------------------------------------
exports.unittest = function(filename, testcases) {
    if (process.env['NODE_ENV']) {
        return
    }

    var ok   = 0
    var fail = []

    for (var i in testcases) {
        var tc = testcases[i]
        try {
            tc.func()
            ok = ok + 1
        }
        catch(e) {
            var r = {
                name   : tc.name,
                reason : e.stack,
            }
            fail.push(r)
        }
    }
    
    for (var i in fail) {
        console.log(fail[i].name)
        console.log(fail[i].reason)
        console.log('--------------------------------------')
    }

    console.log('(' + ok + ') ok, (' + fail.length + ') failed.')

    return { file: filename, ok : ok, fail : fail }
}