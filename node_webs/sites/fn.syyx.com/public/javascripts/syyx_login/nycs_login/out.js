$("a").attr("hidefocus","true");var ajax_url={check_login:"http://fn.syyx.com/syyx_login/nycs/check_user_login/",check_captcha:"http://fn.syyx.com/syyx_login/nycs/check_captcha",get_captcha:"http://fn.syyx.com/syyx_login/nycs/get_captcha",login_out:"http://fn.syyx.com/syyx_login/nycs/login_out",login:"http://fn.syyx.com/syyx_login/nycs/login"},choke=!1;
function check_login(a){$("#verify_img").attr("src",ajax_url.get_captcha+"?r="+Math.random());$.get(ajax_url.check_login+"?r="+Math.random(),function(b){!0==b.login?(a||parent.SyyxLogin.active.load(b.UserAccount),$("#account").html(b.UserAccount),$(".int").css("display","none"),$(".login").css("display","none"),$(".login_out").fadeIn("fast")):(a||parent.SyyxLogin.active.load(null),$(".int").css("display","none"),$(".login").fadeIn("fast"),$(".login_out").css("display","none"))},"jsonp")}check_login();
var is_login_action=!1,errs={user:"",password:"",verify_code:""};function v_err(a,b){a?(b?(errs[a]=b,$("#err_tip").html(b)):$("#err_tip").html(errs[a]),$("#err_tip").css("display","inline")):$("#err_tip").css("display","none")}
!function(){var a=$("#user");a.focus(function(){choke=!1;$(this).addClass("focus");is_login_action&&($("#err_tip").css("display","none"),is_login_action=!1)});a.blur(function(){$(this).removeClass("focus");var a=$(this).val();6>a.length?(v_err("user","\u8bf7\u8f93\u51656-16\u4f4d\u5e10\u53f7\uff01"),$(this).addClass("err")):/^[A-Za-z0-9_]{6,16}$/.test(a)?(v_err(),$(this).removeClass("err")):(v_err("user","\u5e10\u53f7\u53ea\u80fd6-16\u4f4d\uff0c\u53ea\u80fd\u662f\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e0b\u5212\u7ebf\uff01"),
$(this).addClass("err"))})}();!function(){var a=$("#password");a.focus(function(){choke=!1;$(this).addClass("focus");is_login_action&&($("#err_tip").css("display","none"),is_login_action=!1)});a.blur(function(){$(this).removeClass("focus");var a=$(this).val();6>a.length?(v_err("password","\u8bf7\u8f93\u51656-16\u4f4d\u5bc6\u7801\uff01"),$(this).addClass("err")):/^[^\s]{6,16}$/.test(a)?(v_err(),$(this).removeClass("err")):(v_err("password","\u5bc6\u7801\u4e0d\u80fd\u6709\u7a7a\u683c\uff01"),$(this).addClass("err"))})}();
var err_code={},captcha="";
!function(){function a(a){$.get(ajax_url.check_captcha+"?v="+a+"&r="+Math.random(),function(c){1==c.type?(v_err("verify_code","\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e"),$("#verify_code").addClass("err"),$("#verify_code").addClass("err"),err_code[a]=1):(v_err(),$("#verify_code").removeClass("err"),captcha=a)},"jsonp")}$("#verify_code").keyup(function(b){var c=$("#verify_code").val().toLowerCase().replace(/[^a-z]/g,""),d=c.length;0!=d&&(4>d?$(this).removeClass("err"):/^[a-zA-Z0-9]{1,4}$/g.test(c)?""!==
captcha?c!==captcha?(v_err("verify_code","\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e"),$(this).addClass("err")):((!b||13!==b.which)&&v_err(),$(this).removeClass("err")):err_code[c]?(v_err("verify_code","\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e"),$(this).addClass("err")):a(c):(v_err("verify_code","\u8bf7\u8f93\u5165\u5b57\u6bcd\uff0c\u6570\u5b57"),$(this).addClass("err")))});$("#verify_code").focus(function(){choke=!1;$(this).addClass("focus");is_login_action&&($("#err_tip").css("display","none"),is_login_action=
!1)});$("#verify_code").blur(function(){$(this).removeClass("focus");4>$(this).val().length&&(v_err("verify_code","\u8bf7\u8f93\u51654\u4f4d\u9a8c\u8bc1\u7801\uff01"),$(this).addClass("err"))});$("#verify_img").click(function(){$(this).attr("src",ajax_url.get_captcha+"?r="+Math.random());captcha="";err_code={};$("#verify_code").val("")});$("#verify_change").click(function(){$("#verify_img").attr("src",ajax_url.get_captcha+"?r="+Math.random());captcha="";err_code={};$("#verify_code").val("")})}();
function crossDomainPost(){choke=!1;$.get(ajax_url.check_login+"?r="+Math.random(),function(a){parent.$("#post_form").remove();parent.$("#post_iframe").remove();!0==a.login?($("#account").html(a.UserAccount),$(".login").css("display","none"),$(".login_out").fadeIn("fast",function(){parent.SyyxLogin.active.login(a.UserAccount)})):(v_err("ret","\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff01"),$("#sub").removeClass("dis"),$("#sub").html("\u767b \u5f55"))},"jsonp")}
function login_sub(){choke=!0;var a=$("#user").val(),b=$("#password").val(),c=$("#verify_code").val().toLowerCase();6>a.length?($("#user").focus(),v_err("user","\u8bf7\u8f93\u51656-16\u4f4d\u5e10\u53f7\uff01")):6>b.length?($("#password").focus(),v_err("password","\u8bf7\u8f93\u51656-16\u4f4d\u5bc6\u7801\uff01")):4!==c.length?($("#verify_code").focus(),v_err("verify_code","\u8bf7\u8f93\u51654\u4f4d\u9a8c\u8bc1\u7801\uff01")):0<$(".err").length?($(".err").eq(0).focus(),v_err($(".err").eq(0).attr("id"))):
(is_login_action=!0,$("#sub").addClass("dis"),$("#sub").html("\u767b\u5f55\u4e2d.."),parent.SyyxLogin.active.submit(a,b,c))}$("#sub").click(function(){!0!=choke&&login_sub()});$("input").keydown(function(a){!0!=choke&&13==a.which&&login_sub()});function get_login_out(a){reset();choke=!0;$.get(ajax_url.login_out+"?r="+Math.random(),function(b){0==b.type&&(choke=!1,$(".login_out").css("display","none"),$(".login").fadeIn("fast"),a())},"jsonp")}$("#to_login").click(function(){!0!=choke&&get_login_out(function(){})});
$("#login_out").click(function(){!0!=choke&&($(this).addClass("dis"),$(this).html("\u9000\u51fa\u4e2d.."),get_login_out(function(){$("#login_out").removeClass("dis");$("#login_out").html("\u5b89\u5168\u9000\u51fa");parent.SyyxLogin.active.logout($("#account").html())}))});
function reset(){$(".login input").val("").removeClass("err");$("#err_tip").css("display","none");$("#err_tip").html("");$("#verify_img").attr("src",ajax_url.get_captcha+"?r="+Math.random());$("#sub").removeClass("dis").html("\u767b \u5f55");captcha="";err_code={};errs={user:"",password:"",verify_code:""}};
