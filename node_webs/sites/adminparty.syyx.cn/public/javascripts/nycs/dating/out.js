var user,images;$(function(){get_image_list();add_image_listener();add_select_listener()});
var check_login=function(){$.post("/login/check",function(b){0==b.ok?document.location="/login.html#nycs/dating.html":(user=b.account,$("body").show())},"json")},get_image_list=function(b){$.get("/nycs/dating/get_image_list?r="+Math.random(),{type:b},function(a){images=a;0==a.length?$("#list").html("\u6ca1\u6709\u6570\u636e"):(show_select(),show_images(0,"all"))},"json")},show_select=function(){var b=images.length,a=Math.ceil(b/8);$("#all_page").html(a);$("#all_data").html(b);for(var b=$("select.page").val(),
c="",d=0;d<a;d++)c+='<option value="'+d+'">'+(d+1)+"</option>";$("select.page").html(c);b&&$("select.page").val(b)},show_images=function(b){var a=8*b,b=a+8>images.length?images.length:a+8;for($("#list tbody").html("");a<b;a++){var c=images[a].src,d=images[a]._id,f=images[a].date,g=images[a].tel,h=images[a].nickname,e="checked"==images[a].checked?"\u5df2\u5ba1\u6838":"\u672a\u5ba1\u6838";"checked"==images[a].checked&&(e+="pass"==images[a].passed?",\u901a\u8fc7":"\u4e0d\u901a\u8fc7");c=format_string("<tr index = '{0}'><td><a href='{1}' target='_blank'><img src='{2}'></a></td><td>{3}</td><td>{4}</td><td>{5}</td><td>{6}</td><td>{7}</td><td><a href='javascript:undefined' class='pass'>\u901a\u8fc7</a><a href='javascript:undefined' class='reject'>\u4e0d\u901a\u8fc7</a><a href='javascript:undefined' class='delete'>\u5220\u9664</a></td></tr>",
a,c,c,d,h,g,f,e);$("#list tbody").append(c)}},add_image_listener=function(){$("#list").delegate("a.pass, a.reject, a.delete","click",function(){var b=$(this).parent().parent(),a=b.attr("index"),c=images[a].id,d=$(this).attr("class");("delete"!=d||confirm("\u786e\u8ba4\u5220\u9664?"))&&$.get("/nycs/dating/action?r="+Math.random(),{action:d,id:c},function(c){"0"==c?("delete"==d&&(images.splice(a,1),b.remove(),show_images($("select.page").val()),show_select()),alert("\u64cd\u4f5c\u6210\u529f")):alert("\u64cd\u4f5c\u5931\u8d25")})})},
add_select_listener=function(){$("select.page").change(function(){var b=$(this).val();show_images(b)});$("select.filter").change(function(){var b=$(this).val();get_image_list(b)})},formattime=function(b){var a=new Date;a.setTime(b);return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},format_string=function(b){if(0==arguments.length)return null;var a=Array.prototype.slice.call(arguments,1);return b.replace(/\{(\d+)\}/g,function(b,d){return a[d]})};
