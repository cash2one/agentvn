jQuery.extend({createUploadIframe:function(a,b){var c="jUploadFrame"+a,d='<iframe id="'+c+'" name="'+c+'" style="position:absolute; top:-9999px; left:-9999px"';window.ActiveXObject&&("boolean"==typeof b?d+=' src="javascript:false"':"string"==typeof b&&(d+=' src="'+b+'"'));jQuery(d+" />").appendTo(document.body);return jQuery("#"+c).get(0)},createUploadForm:function(a,b){var c="jUploadForm"+a,d="jUploadFile"+a,c=jQuery('<form  action="" method="POST" name="'+c+'" id="'+c+'" enctype="multipart/form-data"></form>'),
e=jQuery(b).clone();jQuery(b).attr("id",d);jQuery(b).before(e);jQuery(b).appendTo(c);jQuery(c).css("position","absolute");jQuery(c).css("top","-1200px");jQuery(c).css("left","-1200px");jQuery(c).appendTo("body");return c},ajaxFileUpload:function(a){var b=(new Date).getTime(),c=jQuery.createUploadForm(b,a.file);jQuery.createUploadIframe(b,a.secureuri);var d="jUploadFrame"+b;try{c=jQuery("#jUploadForm"+b),jQuery(c).attr("action",a.url),jQuery(c).attr("method","POST"),jQuery(c).attr("target",d),jQuery(c).attr("enctype",
"multipart/form-data"),jQuery(c).find("input").attr("name","upload"),jQuery(c).submit()}catch(e){}jQuery("#"+d).load(function(){var b=document.getElementById(d),e=b.contentDocument.body;a.success(e?e.innerHTML:null);setTimeout(function(){jQuery(b).remove();jQuery(c).remove()},100)})}});var preview=window.frames[0].document,j_pre=$(preview);preview.write("<html></html>");var csscode="",wait="",img_dom,nn=0,active=!0,date=new Date,open=date.getTime(),settime,cancel,operands="";preview.close();function setCookie(a,b,c){var d=new Date;d.setDate(d.getSeconds()+c);document.cookie=a+"="+escape(b)}
var formatURL=function(){var a=$("#url").val().replace("http://",""),b=a.indexOf("/"),c=a,d=a+"/",e="/";0<b&&(c=a.substring(0,b),d=a.substring(0,a.lastIndexOf("/"))+"/",e=a.substring(b));return{host:c,path:e,dir:d,url:a}},render=function(a,b,c){img_dom&&""!==b&&(-1<c?img_dom.eq(c).attr("src",a):(c=document.getElementById("preview").contentDocument,a=csscode.replace(RegExp(b,"g"),a),c.getElementsByTagName("style")[0].innerHTML=a))},get_img_info=function(a,b){function c(c,d){var f=b?b.split("."):a.substring(a.lastIndexOf("/")+
1).split(".");"Flash"==operands?/http/.test(a)?$(".show_img").html('<embed width="550" height="490" name="plugin" id="b_img" src="'+a+'" type="application/x-shockwave-flash">'):$(".show_img").html('<img width="200" height="200" src="/images/flash.jpg" />'):$("#b_img").eq(0).attr("src",a);var g=$("#img_info span"),j=$("#img_info em"),i=$("#img_info i");j.html("");i.removeClass("ok");i.removeClass("no");if(b){j.eq(0).html("\u672c\u5730\u6587\u4ef6");j.eq(1).html(f[0]);j.eq(2).html(f[1]);j.eq(3).html(c);
j.eq(4).html(d);for(f=1;5>f;f++)j.eq(f).html()!==g.eq(f).html()?i.eq(f-1).addClass("no"):i.eq(f-1).addClass("ok")}else g.eq(0).html(a),g.eq(1).html(f[0]),g.eq(2).html(f[1]),g.eq(3).html(c),g.eq(4).html(d)}if("Flash"==operands)c("\u672a\u77e5","\u672a\u77e5");else{var d=new Image;d.src=a;d.complete?c(d.width,d.height):d.onload=function(){c(d.width,d.height);d.onload=null};delete d}},close=function(){$("#mange").hide("fast");$("#upload_l").html("");$("#newsee").unbind("click");$("#newurl").unbind("click");
$("#oldurl").unbind("click")},manage=function(){$("#img_list span").click(function(){var a=$(this),b=a.attr("iid")||-1;operands="-2"==b?"Flash":"";var c=$(this).parent(),d=c.find(".new").attr("src"),e=c.find(".old").attr("src"),h=0;get_img_info(e);if(d){var f="new";$("#upload_l").append(c.children("input"));$("#newurl").addClass("check");get_img_info(d,$(this).data("new_name"))}else f="old",$("#newurl").css("display","none"),$("#oldurl").css("display","none"),c.find(".old"),$("#upload_l").html("<input type='file' size='45'>");
$("#mange").show("fast");var g,j,i=a.parent(),k=document.getElementById("img_info").getElementsByTagName("input")[0];k.onchange=function(){var a=this.files[0];try{j=window.URL.createObjectURL(a),g=a.name}catch(b){j=a.getAsDataURL(),g=a.fileName}$("#newurl").css("display","inline");$("#oldurl").css("display","inline");$("#newurl").addClass("check");$("#oldurl").removeClass("check");d=j;h=1;f="new";get_img_info(j,g)};$("#newsee").click(function(){"old"==f?(i.attr("class",""),a.removeData("new_name"),
i.children("input").remove(),a.html("\u4fee\u6539"+operands),i.find(".new").attr("src",""),render(e,d,b)):(a.data("new_name",g),a.html("\u91cd\u6539"+operands),"Flash"==operands?i.find(".new").attr("src","/images/flash.jpg"):i.find(".new").attr("src",j),i.append(k),$("#img_info .no").length?i.attr("class","s1"):1==h&&(i.attr("class","s2"),i.find("button").css("margin-top",c.find(".new")[0].offsetHeight/2-17+"px")),render(j,e,b));$("#ok_num").css("display","inline");$("#see_num").css("display","inline");
var n=$("#img_list span").length,o=$("#img_list .s1").length,m=$("#img_list .s2").length,l=$("#img_list .s4").length+$("#img_list .s3").length;$("#all_num").html(n-l);$("#see_num").html(l+m+o);$("#ok_num").html(l+m);close()});$("#newurl").click(function(){"Flash"==operands?$(".show_img").html('<img width="200" height="200" src="/images/flash.jpg" />'):$("#b_img").attr("src",d);$(this).addClass("check");$("#oldurl").removeClass("check");f="new"});$("#oldurl").click(function(){"Flash"==operands?$(".show_img").html('<embed width="550" height="400" name="plugin" id="b_img" src="'+
e+'" type="application/x-shockwave-flash">'):$("#b_img").attr("src",e);$(this).addClass("check");$("#newurl").removeClass("check");f="old"})})},get_success=function(){$("#get").html("\u518d\u6b21\u5206\u6790");var a=function(){setCookie("url",$("#url").val());window.location="/get"};$("#get").click(a);$("#url").keydown(function(b){13==b.keyCode&&a()});$("#tab span").addClass("live");for(var b=4;b--;)$("#tab span").eq(b).click(function(a){return function(){$("#main .box").removeClass("check");$("#tab span").removeClass("check");
0==nn&&($("#tab em").css("display","inline"),$("#all_num").html($("#img_list span").length),nn=1);3==a?($("#tab span").eq(3).addClass("check"),$("#main .box").eq(2).addClass("check"),$("#img_list").attr("id","rank_list")):($("#tab span").eq(a).addClass("check"),$("#main .box").eq(a).addClass("check"),$("#rank_list").length&&$("#rank_list").attr("id","img_list"))}}(b));manage()},sulist=function(){var a=$(window.frames[0].document),b="",c=img_dom=a.find("img"),d=c.length;info("-\u83b7\u53d6IMG\u56fe\u7247<br />");
for(var e="http://"+formatURL().host+"/",h=0;h<d;h++){var f=c.eq(h).attr("src");f!==e&&(b+='<div><img onerror="$(this).parent().remove();" class="old" src="'+f+'" /><img class="new" src="" /><button onclick="return upload($(this))">\u4e0a\u4f20\u66ff\u6362</button><i onclick="return opentime($(this))">\u5b9a\u65f6</i><span iid='+h+">\u4fee\u6539</span><em></em></div>")}info("-\u83b7\u53d6\u6240\u6709\u80cc\u666f\u56fe\u7247<br />");if(csscode!==e){var c=csscode.match(/http.+?\)/g),d=[],e=[],g;for(g in c)h=
c[g],h!==d[g]&&1!=e[h]&&(d.push(h),e[h]=1);c=d;g=c.length;for(d=0;d<g;d++)b+='<div><img onerror="$(this).parent().remove();" class="old" src="'+c[d].replace(/\)/g,"")+'" /><img class="new" src="" /><button onclick="return upload($(this))">\u4e0a\u4f20\u66ff\u6362</button><i onclick="return opentime($(this))">\u5b9a\u65f6</i><span>\u4fee\u6539</span><em></em></div>'}a=a.find("object");info("-\u83b7\u53d6\u9875\u9762Flash<br />");for(g=0;g<a.length;g++)if(c=a.eq(g).attr("data"))/http\:\/\//.test(c)||
(c="http://"+formatURL().host+c),b+='<div><embed width="250" height="200" class="old" name="plugin" src="'+c+'" type="application/x-shockwave-flash"><img src="" class="new"/><button onclick="return upload($(this))">\u4e0a\u4f20\u66ff\u6362</button><i onclick="return opentime($(this))">\u5b9a\u65f6</i><span iid="-2">\u4fee\u6539Flash</span><em></em></div>';$("#img_list").prepend(b);info("<em>\u221a\u8d44\u6e90\u7ba1\u7406\u5217\u8868\u751f\u6210\u5b8c\u6bd5</em><br /><br /><em>\u5168\u90e8\u5904\u7406\u5b8c\u6bd5\uff01</em>\u60a8\u53ef\u4ee5\u70b9\u51fb <span>\u8d44\u6e90\u7ba1\u7406</span> \u8fdb\u884c\u56fe\u7247\u66ff\u6362\uff0c\u5728 <span>\u4fee\u6539\u9884\u89c8</span> \u4e2d\u9884\u89c8\u4fee\u6539\u6548\u679c");
get_success()},info=function(a){$("#ajax_info").append(a)},htmled=function(){$("#wait").html("");clearInterval(wait);info("<em>\u221a\u9884\u89c8\u56fe\u8f7d\u5165\u5b8c\u6bd5</em><br />-\u5f00\u59cb\u5206\u6790CSS\u5916\u90e8\u6587\u4ef6<br />");$(".preview>.res_info").css("display","none");for(var a=document.getElementById("preview").contentDocument,b=a.styleSheets,c=b.length,d=[],e=0;e<c;e++)b[e].href&&d.push(b[e].href);var b=jQuery.unique(d),h=d.length,e=0;info("-\u68c0\u6d4b\u5230CSS\u5916\u90e8\u6587\u4ef6"+
h+"\u4e2a<br />");var f=function(b){e++;csscode+=b;if(e<h)info("<em>\u221a\u89e3\u6790\u6210\u529f\u3002</em><br />-\u6b63\u5728\u89e3\u6790\u7b2c"+(e-0+1)+"\u4e2aCSS\u6587\u4ef6\uff1a"+d[e]+"<br />"),$.post("/get_css",{url:d[e].replace("http://","")},f,"html");else{info("<em>\u221a\u89e3\u6790\u6210\u529f\u3002</em><br />-\u6b63\u5728\u67e5\u627e\u5185\u5d4c\u6837\u5f0f<br />");if(b=$(a).find("style").html()){for(var c=formatURL().dir,b=b.replace(/\n+|\r+/g,"").replace(/^\s+\(\s+$/g,"").replace(/\'/g,
'"').replace(/\(\"/g,"(").replace(/\"\)/g,")").replace(/\/\*.*?\*\//g,"").replace(/url\(/g,"url("+c).replace(RegExp(c+"http://","g"),"http://").replace(RegExp(c,"g"),formatURL().host+"/").split("}"),c="",i=b.length,k=0;k<i;k++)/url\(/.test(b[k])&&(c+=b[k]+"}");csscode+=c}info("-\u5728\u9884\u89c8\u56fe\u4e2d\u5199\u5165\u9700\u8981\u63a7\u5236\u7684\u6837\u5f0f<br />");b=a.getElementsByTagName("head")[0];a.getElementsByTagName("style")[0]||(c=document.createElement("style"),c.tyle="text/css",b.appendChild(c));
a.getElementsByTagName("style")[0].innerHTML=csscode;info("<em>\u221a\u5199\u5165\u6837\u5f0f\u6210\u529f\u3002</em><br />-\u5f00\u59cb\u751f\u6210\u8d44\u6e90\u7ba1\u7406\u5217\u8868<br />");$("#img_list .res_info").css("display","none");sulist(a)}};0<h?(info("-\u5f00\u59cb\u89e3\u6790\u7b2c1\u4e2aCSS\u6587\u4ef6\uff1a"+d[0]+"<br />"),$.post("/get_css",{url:d[0].replace("http://","")},f,"html")):f()};
function start(){if("\u8f93\u5165\u9875\u9762\u5730\u5740\u6216\u5355\u56fe\u7247\u3001Flash\u5730\u5740\uff0c\u518d\u70b9\u51fb\u53f3\u8fb9\u7684\u6309\u94ae\u3002"!==$("#url").val()&&""!==$("#url").val()){var a=$("#url").val().substr(-3);"jpg"==a||"png"==a||"gif"==a?($("#img_list").html('<div><img onerror="$(this).parent().remove();" class="old" src="'+$("#url").val()+'" /><img class="new" src="" /><button onclick="return upload($(this))">\u4e0a\u4f20\u66ff\u6362</button><i onclick="return opentime($(this))">\u5b9a\u65f6</i><span>\u4fee\u6539</span><em></em></div>'),
get_success(),$("#get").addClass("ed"),info("<em>\u221a\u5355\u56fe\u7247\u5206\u6790\u6210\u529f</em>")):"swf"==a?(operands="Flash",$("#img_list").html('<div><embed width="250" height="200" class="old" name="plugin" src="'+$("#url").val()+'" type="application/x-shockwave-flash"><img src="" class="new"/><button onclick="return upload($(this))">\u4e0a\u4f20\u66ff\u6362</button><i onclick="return opentime($(this))">\u5b9a\u65f6</i><span iid="-2">\u4fee\u6539Flash</span><em></em></div>'),get_success(),
$("#get").addClass("ed"),info("<em>\u221aFlash\u5206\u6790\u6210\u529f</em>")):(a=formatURL().host+"&path="+formatURL().path+"&dir="+formatURL().dir,$("#preview").attr("src","/get_html?host="+a),$("#get").html("\u5206\u6790\u4e2d\u2026"),$("#get").addClass("ed"),$("#ajax_info").html("-\u5f00\u59cb\u89e3\u6790\uff1a"+formatURL().host+formatURL().path+"<br />-\u6b63\u5728\u8f7d\u5165\u9884\u89c8\u56fe<br />"),wait=setInterval(function(){$("#wait").append(".")},300),$("#get").unbind("click"),$("#url").unbind("keydown"))}else info("<span>\u8bf7\u8f93\u5165\u9700\u8981\u89e3\u6790\u7684\u9875\u9762\u5730\u5740!</span>")}
$("#get").click(start);$("#url").keydown(function(a){13==a.keyCode&&start()});function getCookie(a){return 0<document.cookie.length&&(c_start=document.cookie.indexOf(a+"="),-1!=c_start)?(c_start=c_start+a.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}getCookie("url")&&($("#url").val(getCookie("url")),start());setCookie("url","",-1);
$("#url").focus(function(){$("#url").val()=="\u8f93\u5165\u9875\u9762\u5730\u5740\u6216\u5355\u56fe\u7247\u3001Flash\u5730\u5740\uff0c\u518d\u70b9\u51fb\u53f3\u8fb9\u7684\u6309\u94ae\u3002"&&$("#url").val("")});$("#url").blur(function(){$("#url").val()==""&&$("#url").val("\u8f93\u5165\u9875\u9762\u5730\u5740\u6216\u5355\u56fe\u7247\u3001Flash\u5730\u5740\uff0c\u518d\u70b9\u51fb\u53f3\u8fb9\u7684\u6309\u94ae\u3002")});
var closetime=function(){$("#time").hide("fast");$("#info").html("")},opentime=function(a){if(a.parent().attr("class")!=="s3"){$("#time").show("fast");var b;settime=function(){b=testtime();if(b!=false){$("#time").hide("fast");a.data("retime",b[0]);a.html(b[1][0]+"\u5e74"+b[1][1]+"\u6708"+b[1][2]+"\u65e5"+b[1][3]+"\u70b9"+b[1][4]+"\u5206");$("#info").html("");a.addClass("set");alert("\u5b9a\u65f6\u8bbe\u7f6e\u6210\u529f\uff0c\u8bf7\u70b9\u3010\u4e0a\u4f20\u66ff\u6362\u3011");settime=null}};cancel=
function(){$("#time").hide("fast");a.removeData("retime");a.html("\u5b9a\u65f6");$("#info").html("");a.removeClass("set");cancel=null}}},testtime=function(){for(var a=$("#settime input"),b=[],c=0;c<5;c++){b[c]=a.eq(c).val().replace(/\D/g,"");b[c]=Number(b[c])}if(b[1]>12||b[2]>31||b[3]>23||b[4]>60||!b[0]||!b[1]||!b[2]){$("#info").html("\u6708\u3001\u65e5\u3001\u65f6\u6216\u8005\u5206\u949f\u7684\u683c\u5f0f\u4e0d\u5bf9");return false}if(b[1]==2&&(b[2]>29||b[0]%4!==0&&b[2]==29)){$("#info").html(b[0]+
"\u5e742\u6708\u6709"+b[2]+"\u5929\u5417\uff1f");return false}a=(new Date(b[0],b[1]-1,b[2],b[3],b[4],0)).getTime();if(a<open){$("#info").html("\u65f6\u95f4\u8bbe\u7f6e\u5230\u4e86\u8fc7\u53bb\u5427\uff1f");return false}$("#info").html("");return[a,b]};
function upload(a){active=true;var b=a.parent(),c=b.find("i").html();if(confirm("\u786e\u5b9a\u5df2\u7ecf\u5907\u4efd\u539f\u56fe\u4e86\u5417\uff1f\n\u66ff\u6362\u4ee5\u540e\u5c06\u627e\u4e0d\u5230\u539f\u56fe\u4e86\u3002")&&confirm("\u786e\u5b9a\uff08"+(c=="\u5b9a\u65f6"?"\u7acb\u5373":c)+"\uff09\u4e0a\u4f20\u66ff\u6362\u5417\uff1f")){c=b.find("img").eq(0).attr("src");b.find("span").attr("iid")=="-2"&&(c=b.find("embed").attr("src"));var c=c.replace("http://",""),d=b.find("i").data("retime"),e="&retime=";
d&&(e=e+d);a.html("\u4e0a\u4f20\u4e2d..");$.ajaxFileUpload({url:"/upload?file="+c+"&active=set&host="+formatURL().url+e,secureuri:false,file:b.find("input").eq(0),dataType:"json",success:function(c){active=false;$("#all_num").html($("#all_num").html()-1);if(c=="\u66ff\u6362\u6210\u529f"||c=="\u5b9a\u65f6\u6210\u529f"){a.html(c);b.attr("class","s3");a.attr("onclick","")}else if(c=="\u767b\u5f55\u8d85\u65f6\u3002\u8bf7\u91cd\u65b0\u767b\u5f55\uff01"){alert(c);document.location="/login"}else{if(c=="\u6ca1\u6709\u6743\u9650"){alert("\u8fd9\u4e2a\u6587\u4ef6\u6ca1\u6709\u6743\u9650\u4fee\u6539\u3002");
a.html(c);a.attr("onclick","")}else a.html("\u518d\u8bd5\u4e00\u6b21");b.attr("class","s4")}}})}}
$.get("/get_ajax",function(a){if(a.name=="")alert("\u767b\u5f55\u8d85\u65f6");else{$("#name").html(a.name);$("#record").html(a.record);$("#setftp").html(a.ftp);Math.abs(open-a.time)>6E5&&$("#info").html("\u60a8\u7535\u8111\u7684\u7cfb\u7edf\u65f6\u95f4\u4e0d\u51c6\u786e\uff0c\u5c06\u5f71\u54cd\u5b9a\u65f6\u66ff\u6362\uff01");input=$("#settime input");input.eq(0).val(date.getFullYear());input.eq(1).val(date.getMonth()+1);input.eq(2).val(date.getDate());input.eq(3).val(date.getHours()+1)}},"json");
window.onbeforeunload=function(){return" "};var git_run=function(){$("#git").addClass("disable");$("#git").unbind("click");$("#git").html("...");$.get("/git",function(a){if(a=="\u767b\u5f55\u8d85\u65f6"){alert("\u767b\u5f55\u8d85\u65f6");window.location="/login"}else if(a=="ok"){$("#git").removeClass("disable");$("#git").click(git_run);$("#git").html("Git")}else a=="err"&&$("#git").html("\u9519\u8bef")})};$("#git").click(git_run);
