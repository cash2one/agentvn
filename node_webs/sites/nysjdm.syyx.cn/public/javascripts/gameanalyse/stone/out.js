jQuery.fn.table2CSV=function(b){function g(a){var c=a.join("");0<a.length&&""!=c&&(a=a.join(b.separator),e[e.length]=a)}function f(a){var c=RegExp(/["]/g),a=a.replace(c,"\u9225\ufffd"),c=RegExp(/\<[^\<]+\>/g),a=a.replace(c,"");return""==a?"":'"'+a+'"'}function k(a){var c=window.open("","csv","height=400,width=600");c.document.write("<html><head><title>CSV</title>");c.document.write("</head><body >");c.document.write('<textArea cols=70 rows=15 wrap="off" >');c.document.write(a);c.document.write("</textArea>");
c.document.write("</body></html>");c.document.close();return!0}var b=jQuery.extend({separator:",",header:[],delivery:"popup"},b),e=[],d=b.header.length,h=[];if(0<d)for(var i=0;i<d;i++)h[h.length]=f(b.header[i]);else $(this).filter(":visible").find("th").each(function(){"none"!=$(this).css("display")&&(h[h.length]=f($(this).html()))});g(h);$(this).find("tr").each(function(){var a=[];$(this).filter(":visible").find("td").each(function(){"none"!=$(this).css("display")&&(a[a.length]=f($(this).html()))});
g(a)});return"popup"==b.delivery?(d=e.join("\n"),k(d)):d=e.join("\n")};$(document).ready(function(){$("#txtStartDate,#txtEndDate").datepicker({changeMonth:!0,changeYear:!0,dayNamesMin:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),dateFormat:"yy-mm-dd",monthNamesShort:"\u4e00\u6708,\u4e8c\u6708,\u4e09\u6708,\u56db\u6708,\u4e94\u6708,\u516d\u6708,\u4e03\u6708,\u516b\u6708,\u4e5d\u6708,\u5341\u6708,\u5341\u4e00\u6708,\u5341\u4e8c\u6708".split(","),yearRange:"-60:+00",maxDate:"+0d",duration:"fast"});getServerList();getStoneTypeList();$("#btnQuery").bind("click",
function(){getStoneList()})});
function getServerList(){$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_viewlist?r="+Math.random(),type:"get",dataType:"json",data:{},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(b){$("#serverList").empty();$('<option value="0">\u5168\u670d</option>').appendTo($("#serverList"));$.each(b.rows,function(b,f){$('<option value="'+f.ServerID+'"> '+f.Title+"</option>").appendTo($("#serverList"))})}});$("#txtStartDate").val("");$("#txtEndDate").val("");
$("#InOutTypeList").val(1)}function getStoneTypeList(){$.ajax({url:"http://nysjdm.syyx.cn/parameter/config_class_list?r="+Math.random(),type:"get",dataType:"json",data:{ParamsType:"Stone"},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(b){$("#stoneTypeList").empty();$.each(b.rows,function(b,f){$('<option value="'+f.ID+'"> '+f.ClassName+"</option>").appendTo($("#stoneTypeList"))});$("#stoneTypeList")[0].selectedIndex=4}})}
function getStoneList(){var b="",g="",f={},k=$("#serverList").children("option:selected").val(),e=$("#txtStartDate").val(),d=$("#txtEndDate").val(),h=$("#stoneTypeList").children("option:selected").val(),i=$("#InOutTypeList").children("option:selected").val();!e||""==e?alert("\u67e5\u8be2\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a"):!d||""==d?alert("\u67e5\u8be2\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a"):(b=1==i?"Game_StoneCreate":"Game_StoneDestroy",$.ajax({url:"http://nysjdm.syyx.cn/parameter/config_items_list_able?r="+
Math.random(),type:"get",dataType:"json",data:{ClassID:h,GetType:i},success:function(a){for(var c=a.rows.length,j=0;j<c;j++)g+="["+a.rows[j].ItemNo+"],",f[a.rows[j].ItemNo]=a.rows[j].ItemName;g=g.substring(0,g.length-1);$.ajax({url:"http://nysjdm.syyx.cn/gameanalyse/game_stone_list?r="+Math.random(),type:"get",dataType:"json",data:{TableName:b,StartDate:e,EndDate:d,ServerID:k,ClassID:h,ItemList:g,GetType:i},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){$("#tableStone thead").remove();
$("#tableStone tbody").remove();var b,c="<tbody>",g=a.rows.length;b="<thead><tr><th>\u65e5\u671f</th>";for(var d in a.rows[0])f[d]&&(b+="<th>"+f[d]+"</th>");$(b+"<th>\u5408\u8ba1</th></tr></thead>").appendTo("#tableStone");for(b=0;b<g;b++){d=0;var c=c+("<tr class='newrow'><td>"+a.rows[b].CreateDate+"</td>"),e;for(e in a.rows[0])if("CreateDate"!=e){var h="NULL"==a.rows[b][e]?0:a.rows[b][e];d+=h;c+="<td>"+h+"</td>"}c+="<td>"+d+"</td></tr>"}$(c+"</tbody>").appendTo("#tableStone")}})}}))};
