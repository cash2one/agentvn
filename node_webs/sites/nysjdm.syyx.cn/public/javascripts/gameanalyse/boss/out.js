jQuery.fn.table2CSV=function(c){function h(a){var b=a.join("");0<a.length&&""!=b&&(a=a.join(c.separator),f[f.length]=a)}function d(a){var b=RegExp(/["]/g),a=a.replace(b,"\u9225\ufffd"),b=RegExp(/\<[^\<]+\>/g),a=a.replace(b,"");return""==a?"":'"'+a+'"'}function i(a){var b=window.open("","csv","height=400,width=600");b.document.write("<html><head><title>CSV</title>");b.document.write("</head><body >");b.document.write('<textArea cols=70 rows=15 wrap="off" >');b.document.write(a);b.document.write("</textArea>");
b.document.write("</body></html>");b.document.close();return!0}var c=jQuery.extend({separator:",",header:[],delivery:"popup"},c),f=[],g=c.header.length,e=[];if(0<g)for(var j=0;j<g;j++)e[e.length]=d(c.header[j]);else $(this).filter(":visible").find("th").each(function(){"none"!=$(this).css("display")&&(e[e.length]=d($(this).html()))});h(e);$(this).find("tr").each(function(){var a=[];$(this).filter(":visible").find("td").each(function(){"none"!=$(this).css("display")&&(a[a.length]=d($(this).html()))});
h(a)});return"popup"==c.delivery?(g=f.join("\n"),i(g)):g=f.join("\n")};$(document).ready(function(){$("#txtStartDate,#txtEndDate").datepicker({changeMonth:!0,changeYear:!0,dayNamesMin:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),dateFormat:"yy-mm-dd",monthNamesShort:"\u4e00\u6708,\u4e8c\u6708,\u4e09\u6708,\u56db\u6708,\u4e94\u6708,\u516d\u6708,\u4e03\u6708,\u516b\u6708,\u4e5d\u6708,\u5341\u6708,\u5341\u4e00\u6708,\u5341\u4e8c\u6708".split(","),yearRange:"-60:+00",maxDate:"+0d",duration:"fast"});getServerList();getBossItemList();$("#btnQuery").bind("click",
function(){getBossPage(1,20)})});
function getServerList(){$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_viewlist?r="+Math.random(),type:"get",dataType:"json",data:{},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(c){$("#serverList").empty();$.each(c.rows,function(c,d){$('<option value="'+d.ServerID+'"> '+d.Title+"</option>").appendTo($("#serverList"))})}});$("#txtStartDate").val("");$("#txtEndDate").val("");$("#bossList").val(0);$("#txtLine").val(0)}
function getBossItemList(){$.ajax({url:"http://nysjdm.syyx.cn/parameter/config_items_list_byparams?r="+Math.random(),type:"get",dataType:"json",data:{ParamsType:"Boss",GetType:0},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(c){$("#bossList").empty();$('<option value="0">\u5168\u90e8</option>').appendTo($("#bossList"));$.each(c.rows,function(c,d){$('<option value="'+d.ItemNo+'"> '+d.ItemName+"</option>").appendTo($("#bossList"))})}})}
function getBossPage(c,h){var d=$("#serverList").children("option:selected").val(),i=$("#txtStartDate").val(),f=$("#txtEndDate").val(),g=$("#bossList").children("option:selected").val(),e=$("#txtLine").val();if(!i||""==i)alert("\u67e5\u8be2\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a");else if(!f||""==f)alert("\u67e5\u8be2\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a");else{if(!e||""==e)e=0;$.ajax({url:"http://nysjdm.syyx.cn/gameanalyse/game_boss_page?r="+Math.random(),type:"get",dataType:"json",
data:{ServerID:d,Line:e,BossID:g,StartDate:i,EndDate:f,Page:c,PageSize:h},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(c){$("#tableBoss tbody").find("tr.newrow").remove();$.each(c.rows,function(a,b){$("<tr class='newrow'></tr>").append("<td>"+b.RowNumber+"</td><td>"+b.Line+"</td><td>"+b.BossName+"</td><td>"+b.LiveTime+"</td><td>"+b.KillTime+"</td>").appendTo($("#tableBoss tbody"))});$("#divPagination").pagination({total:c.output,pageSize:h,
showPageList:!1,showRefresh:!1,onSelectPage:function(a,b){getBossPage(a,b)}})}})}};
