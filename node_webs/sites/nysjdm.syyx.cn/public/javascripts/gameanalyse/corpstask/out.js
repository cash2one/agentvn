$(document).ready(function(){$("#txtStartDate,#txtEndDate").datepicker({changeMonth:!0,changeYear:!0,dayNamesMin:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),dateFormat:"yy-mm-dd",monthNamesShort:"\u4e00\u6708,\u4e8c\u6708,\u4e09\u6708,\u56db\u6708,\u4e94\u6708,\u516d\u6708,\u4e03\u6708,\u516b\u6708,\u4e5d\u6708,\u5341\u6708,\u5341\u4e00\u6708,\u5341\u4e8c\u6708".split(","),yearRange:"-60:+00",maxDate:"+0d",duration:"fast"});getServerList();getCorpsTaskTypeList();$("#btnQuery").bind("click",
function(){getCoprsTaskList()})});
function getServerList(){$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_viewlist?r="+Math.random(),type:"get",dataType:"json",data:{},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){$("#serverList").empty();$('<option value="0">\u5168\u670d</option>').appendTo($("#serverList"));$.each(a.rows,function(a,b){$('<option value="'+b.ServerID+'"> '+b.Title+"</option>").appendTo($("#serverList"))})}});$("#txtStartDate").val("");$("#txtEndDate").val("");
$("#txtCorpsName").val("")}function getCorpsTaskTypeList(){$.ajax({url:"http://nysjdm.syyx.cn/parameter/config_class_list?r="+Math.random(),type:"get",dataType:"json",data:{ParamsType:"CorpsTask"},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){$("#corpsTaskList").empty();$.each(a.rows,function(a,b){$('<option value="'+b.ID+'"> '+$.trim(b.ClassName)+"</option>").appendTo($("#corpsTaskList"))});$("#corpsTaskList")[0].selectedIndex=0}})}
function getCoprsTaskList(){var a="",h={},b=$("#serverList").children("option:selected").val(),i=$("#txtStartDate").val(),j=$("#txtEndDate").val(),k=$("#corpsTaskList").children("option:selected").val(),d=$("#txtCorpsName").val();if(!i||""==i)$.messager.alert("\u63d0\u793a","<font color=red><b>\u67e5\u8be2\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a</b></font>","error");else if(!j||""==j)$.messager.alert("\u63d0\u793a","<font color=red><b>\u67e5\u8be2\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a</b></font>",
"error");else{if(!d||""==d)d="";$.ajax({url:"http://nysjdm.syyx.cn/parameter/config_items_list_able?r="+Math.random(),type:"get",dataType:"json",data:{ClassID:k,GetType:0},success:function(e){for(var l=e.rows.length,f=0;f<l;f++)a+="["+e.rows[f].ItemNo+"],",h[e.rows[f].ItemNo]=e.rows[f].ItemName;a=a.substring(0,a.length-1);$.ajax({url:"http://nysjdm.syyx.cn/gameanalyse/game_corpstask_list?r="+Math.random(),type:"get",dataType:"json",data:{StartDate:i,EndDate:j,ServerID:b,ClassID:k,ItemList:a,CorpsName:d},
beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){$("#tableCorpsTask thead").remove();$("#tableCorpsTask tbody").remove();var c,b="<tbody>",f=a.rows.length;c="<thead><tr><th>\u65e5\u671f</th>";for(var g in a.rows[0])h[g]&&(c+="<th>"+h[g]+"</th>");$(c+"<th>\u5408\u8ba1</th></tr></thead>").appendTo("#tableCorpsTask");for(c=0;c<f;c++){g=0;var b=b+("<tr class='newrow'><td>"+a.rows[c].CreateDate+"</td>"),d;for(d in a.rows[0])if("CreateDate"!=d){var e=
"NULL"==a.rows[c][d]?0:a.rows[c][d];g+=e;b+="<td>"+e+"</td>"}b+="<td>"+g+"</td></tr>"}$(b+"</tbody>").appendTo("#tableCorpsTask")}})}})}};
