function formatEnabled(a){return a?'<font color="blue">\u662f</font>':'<font color="red">\u5426</font>'}function formateDate(a){a=a.substring(a.indexOf(" ")).split(":");return{Hour:a[0],Minute:a[1]}}function getDate(a){var b=a.getFullYear(),c=a.getMonth()+1;10>c&&(c="0"+c);a=a.getDate();10>a&&(a="0"+a);return b+"-"+c+"-"+a};$(document).ready(function(){$("#hiddenID").val(0);get_servertype_list(0);get_server_list();$("#btnAdd").toggle(function(){$("#btnAdd").val("\u53d6\u6d88");clear_form()},function(){$("#btnAdd").val("\u6dfb\u52a0");clear_form()});$("#btnSave").bind("click",function(){0==$("#hiddenID").val()?add_server():upd_server()})});
function get_servertype_list(a){$.ajax({url:"http://nysjdm.syyx.cn/parameter/server_type_list?r="+Math.random(),type:"get",dataType:"json",data:{},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(b){$("#radioServerType").empty();$.each(b.rows,function(b,d){a==d.ID?$('<span><input type="radio" name="servertype" checked="checked" value="'+d.ID+'"> '+d.ParamsTitle+"</input></span>").appendTo($("#radioServerType")):$('<span><input type="radio" name="servertype"  value="'+
d.ID+'"> '+d.ParamsTitle+"</input></span>").appendTo($("#radioServerType"))})}})}
function get_server_list(){$("#listContent").datagrid({url:"http://nysjdm.syyx.cn/parameter/link_server_list?r="+Math.random(),title:"\u670d\u52a1\u5668\u914d\u7f6e",width:900,height:400,fitColumns:!0,nowrap:!1,rownumbers:!0,singleSelect:!0,columns:[[{field:"ServerID",title:"\u670d\u52a1\u5668\u7f16\u53f7",width:80,align:"center"},{field:"Title",title:"\u670d\u52a1\u5668\u540d\u79f0",width:220,align:"center"},{field:"PartName",title:"\u5927\u533a\u540d\u79f0",width:150,align:"center"},{field:"ServerTypeTitle",
title:"\u670d\u52a1\u5668\u7c7b\u578b",width:100,align:"center"},{field:"IsEnabled",title:"\u662f\u5426\u542f\u7528",width:60,align:"center",formatter:function(a){return formatEnabled(a)}},{field:"IsShow",title:"\u662f\u5426\u663e\u793a",width:60,align:"center",formatter:function(a){return formatEnabled(a)}},{field:"op",title:"\u64cd\u4f5c",width:60,align:"center",formatter:function(a,b){return"<a href='#' color='green' onclick=get_record_info("+b.ID+")>\u7f16\u8f91</a>"}}]]})}
function get_record_info(a){$("#hiddenID").val(a);$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_info?r="+Math.random(),type:"get",dataType:"json",data:{ItemID:a},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){0<a.rows.length&&(a=a.rows[0],$("#txtServerID").val(a.ServerID),$("#txtLinkServer").val(a.LinkServer),$("#txtServerAlias").val(a.ServerAlias),$("#chkEnable").attr("checked",a.IsEnabled),$("#chkShow").attr("checked",a.IsShow),
$("#txtJobID").val(a.JobID),get_servertype_list(a.ServerTypeID))}})}function clear_form(){$("#hiddenID").val(0);$("#txtServerID").val("");$("#txtLinkServer").val("");$("#txtServerAlias").val("");$("#chkEnable").attr("checked",!1);$("#chkShow").attr("checked",!1);$("#txtJobID").val("0");get_servertype_list(0)}
function add_server(){var a=$("#txtServerID").val(),b=$("#txtLinkServer").val(),c=$("#txtServerAlias").val(),d="checked"==$("#chkEnable").attr("checked"),g="checked"==$("#chkShow").attr("checked"),f=$("#txtJobID").val(),e=$('input:radio[name="servertype"]:checked').val();!a||""==a||0>=a?$.messager.alert("\u63d0\u793a","<font color=red><b>\u670d\u52a1\u5668\u7f16\u53f7\u4e0d\u80fd\u4e3a\u7a7a\u6216\u8005\u4e3a\u96f6</b></font>","error"):!b||""==b?$.messager.alert("\u63d0\u793a","<font color=red><b>\u94fe\u63a5\u670d\u52a1\u5668\u4e0d\u80fd\u4e3a\u7a7a</b></font>",
"error"):!c||""==c?$.messager.alert("\u63d0\u793a","<font color=red><b>\u670d\u52a1\u5668\u522b\u540d\u4e0d\u80fd\u4e3a\u7a7a</b></font>","error"):!e||""==e?$.messager.alert("\u63d0\u793a","<font color=red><b>\u670d\u52a1\u5668\u7c7b\u522b\u4e0d\u80fd\u4e3a\u7a7a</b></font>","error"):$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_add?r="+Math.random(),type:"get",dataType:"json",data:{ServerID:a,LinkServer:b,ServerAlias:c,IsEnabled:d,IsShow:g,JobID:f,ServerType:e},beforeSend:function(){$("#loading").show()},
complete:function(){$("#loading").hide()},success:function(a){0<a.retcode?($.messager.alert("\u63d0\u793a","\u6dfb\u52a0\u670d\u52a1\u5668\u914d\u7f6e\u6210\u529f","info"),get_server_list()):-1==a.retcode?$.messager.alert("\u63d0\u793a","<font color=red><b>\u5df2\u7ecf\u5b58\u5728\u76f8\u540c\u7684\u670d\u52a1\u5668ID</b></font>","error"):$.messager.alert("\u63d0\u793a","<font color=red><b>\u6dfb\u52a0\u670d\u52a1\u5668\u914d\u7f6e\u5931\u8d25</b></font>","error")}})}
function upd_server(){var a=$("#hiddenID").val(),b=$("#txtLinkServer").val(),c=$("#txtServerAlias").val(),d="checked"==$("#chkEnable").attr("checked"),g="checked"==$("#chkShow").attr("checked"),f=$("#txtJobID").val(),e=$('input:radio[name="servertype"]:checked').val();if(!b||""==b)$.messager.alert("\u63d0\u793a","<font color=red><b>\u94fe\u63a5\u670d\u52a1\u5668\u4e0d\u80fd\u4e3a\u7a7a</b></font>","error");else if(!c||""==c)$.messager.alert("\u63d0\u793a","<font color=red><b>\u670d\u52a1\u5668\u522b\u540d\u4e0d\u80fd\u4e3a\u7a7a</b></font>",
"error");else if(!e||""==e)$.messager.alert("\u63d0\u793a","<font color=red><b>\u670d\u52a1\u5668\u7c7b\u522b\u4e0d\u80fd\u4e3a\u7a7a</b></font>","error");else{if(!f||""==f)f=1;$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_upd?r="+Math.random(),type:"get",dataType:"json",data:{ID:a,LinkServer:b,ServerAlias:c,IsEnabled:d,IsShow:g,JobID:f,ServerType:e},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){0==a.retcode?($.messager.alert("\u63d0\u793a",
"\u66f4\u65b0\u670d\u52a1\u5668\u914d\u7f6e\u6210\u529f","info"),get_server_list()):$.messager.alert("\u63d0\u793a","<font color=red><b>\u66f4\u65b0\u670d\u52a1\u5668\u914d\u7f6e\u5931\u8d25</b></font>","error")}})}};
