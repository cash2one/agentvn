function formatEnabled(a){return a?'<font color="blue">\u662f</font>':'<font color="red">\u5426</font>'}function formateDate(a){a=a.substring(a.indexOf(" ")).split(":");return{Hour:a[0],Minute:a[1]}}function getDate(a){var b=a.getFullYear(),c=a.getMonth()+1;10>c&&(c="0"+c);a=a.getDate();10>a&&(a="0"+a);return b+"-"+c+"-"+a}
function get_checkbox_server(){var a="<div class='serverlist_box'>";$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_list?r="+Math.random(),type:"get",dataType:"json",data:{},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(b){$("#checkboxDetailList").empty();for(var c=b.rows.length,d={},e=0;e<c;e++)d[b.rows[e].PartName]?d[b.rows[e].PartName].push({Title:b.rows[e].Title,ServerID:b.rows[e].ServerID}):d[b.rows[e].PartName]=[{Title:b.rows[e].Title,
ServerID:b.rows[e].ServerID}];var b=0,f;for(f in d){b++;a+="<div class='part_server'>";a+="<h1><input type='checkbox' value='0' onclick=\"select_all(this,'Part"+b+"')\"></input><font size='3' color='#9F5F9F'>"+f+"</font></h1>";a+="<div class='about_part'>";c=d[f].length;for(e=0;e<c;e++){var g=d[f][e];a+="<input id='checkServer"+g.ServerID+"' name='Part"+b+"' type='checkbox' value='"+g.ServerID+"'>"+g.Title+"</input>"}a+="</div></div>"}a+="</div>";$(a).appendTo("#checkboxDetailList");$("#checkboxserverList").dialog({buttons:[{text:"\u786e\u5b9a",
iconCls:"icon-ok",handler:function(){close_window()}}]})}})}function close_window(){$("#checkboxserverList").window("close")}function show_window(){$("#checkboxserverList").window("open")}
function get_server_value(){var a="",b="";if(document.getElementById("rdAll").checked)return 0;$(".about_part input[type='checkbox']:checked").each(function(){a+=$(this).val()+",";b+=$(this).parent().text()+"--"});if(0==a.length)return-1;a=a.substring(0,a.length-1);b=b.substring(0,b.length-2);$("#hiddenServerName").val(b);return a}function select_all(a,b){var c=document.getElementsByName(b);if(void 0!=c)for(var d=0;d<c.length;d++)c[d].checked=a.checked};$(document).ready(function(){$("#divserverTip").addClass("displaynone");$("#txtStatDate").datepicker({changeMonth:!0,changeYear:!0,dayNamesMin:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),dateFormat:"yy-mm-dd",monthNamesShort:"\u4e00\u6708,\u4e8c\u6708,\u4e09\u6708,\u56db\u6708,\u4e94\u6708,\u516d\u6708,\u4e03\u6708,\u516b\u6708,\u4e5d\u6708,\u5341\u6708,\u5341\u4e00\u6708,\u5341\u4e8c\u6708".split(","),yearRange:"-60:+00",maxDate:"+0d",duration:"fast"});$("#txtEndDate").datepicker({changeMonth:!0,
changeYear:!0,dayNamesMin:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),dateFormat:"yy-mm-dd",monthNamesShort:"\u4e00\u6708,\u4e8c\u6708,\u4e09\u6708,\u56db\u6708,\u4e94\u6708,\u516d\u6708,\u4e03\u6708,\u516b\u6708,\u4e5d\u6708,\u5341\u6708,\u5341\u4e00\u6708,\u5341\u4e8c\u6708".split(","),yearRange:"-60:+00",maxDate:"+0d",duration:"fast"});getServerList();$("#btnQuery").bind("click",function(){get_dailyonline_list()});$("#rdCus").click(function(){get_checkbox_server()});setInterval(get_dailyonline_list,
6E5)});
function getServerList(){$.ajax({url:"http://nysjdm.syyx.cn/parameter/link_server_viewlist?r="+Math.random(),type:"get",dataType:"json",data:{},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){$("#serverList").empty();$('<option value="0">\u5168\u670d</option>').appendTo($("#serverList"));$.each(a.rows,function(a,b){$('<option value="'+b.ServerID+'"> '+b.Title+"</option>").appendTo($("#serverList"))})}});var a=getDate(new Date);$("#txtStatDate").val(a);$("#txtEndDate").val(a);
$("#queryType").val(0);$("input[name=server]").get(0).checked=!0;$("#chkShowValue").attr("checked",!1)}
function get_dailyonline_list(){var a=get_server_value(),b=0==a?1:0,c=$("#txtStatDate").val(),d=$("#txtEndDate").val(),e=$("#queryType").val(),f="checked"==$("#chkShowValue").attr("checked"),g="",g=0==a?"\u5168\u670d":-1==a?"\u672a\u9009\u62e9\u670d\u52a1\u5668":$("#hiddenServerName").val();$("#divserverTip").removeClass("displaynone").empty();$('<span class="tip_icon"></span><lable>\u670d\u52a1\u5668\uff1a'+g+"</lable>").appendTo("#divserverTip");!c||""==c?$.messager.alert("\u63d0\u793a","<font color=red><b>\u67e5\u8be2\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a</b></font>",
"error"):!d||""==d?$.messager.alert("\u63d0\u793a","<font color=red><b>\u67e5\u8be2\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a</b></font>","error"):(c==d&&2==e&&($("#queryType").val(1),e=1),c!=d&&($("#queryType").val(2),e=2),$.ajax({url:"http://nysjdm.syyx.cn/opanalyse/daily_online_list?r="+Math.random(),type:"get",dataType:"json",data:{StartDate:c,EndDate:d,AllServer:b,ServerID:a,Type:e},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){var b=
"<graph caption='\u5728\u7ebf\u4eba\u6570' animation='0' baseFont='\u5b8b\u4f53' color='8BBA00' baseFontSize='12' xAxisName='\u65f6\u95f4' YAxisName='\u4eba\u6570' formatNumberScale='0' divLineColor='ff5904' showNames='1' ",b=f==0?b+"showValues='0' >":b+"showValues='1' >";$.each(a.rows,function(a,c){if(e==2)b=b+"<set name='"+c.RecordTime+"' value='"+c.Amount+"' hoverText='("+c.RecordTime+")="+c.Amount+"' />";else{var d=formateDate(c.RecordTime),f=d.Hour+":"+d.Minute;b=d.Minute=="00"?b+"<set name='"+
f+"' value='"+c.Amount+"' hoverText='("+f+")="+c.Amount+"' />":b+"<set value='"+c.Amount+"' hoverText='("+f+")="+c.Amount+"' />"}});b=b+"</graph>";a=new FusionCharts("http://s1.syyx.com/nysjdm/FusionCharts/Line.swf","chartLineID","1050","300");a.setDataXML(b);a.render("allServerChart")}}))};
