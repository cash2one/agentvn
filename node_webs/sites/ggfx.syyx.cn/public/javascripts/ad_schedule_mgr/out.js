function formatEnabled(a){return a?"<font color='blue'>\u542f\u7528</font>":"<font color='red'>\u7981\u7528</font>"}function formatSchedule(a){return a?"<font color='blue'>\u5df2\u8bbe\u7f6e</font>":"<font color='red'>\u8bbe\u7f6e\u4e2d</font>"}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}
function getAdUrl(a,b,c,e,d){return 1==d?"<a href='/ad_report_phase.html?ClassID="+a+"&MediaID="+b+"&ADID="+c+"&Date="+e+"'>\u221a</a>":" "}function checkAllByID(a){for(var b=document.getElementsByTagName("input"),c=b.length,e=0;e<c;e++)"checkbox"==b[e].type&&b[e].name==name&&(b[e].checked=a.checked)}function checkAllByName(a,b){var c=document.getElementsByName(b);if(void 0!=c)for(var e=0;e<c.length;e++)c[e].checked=a.checked}
Date.prototype.isLeapYear=function(){return 0==this.getYear()%4&&(0!=this.getYear()%100||0==this.getYear()%400)};
Date.prototype.Format=function(a){a=a.replace(/yyyy|YYYY/,this.getFullYear());a=a.replace(/yy|YY/,9<this.getYear()%100?(this.getYear()%100).toString():"0"+this.getYear()%100);a=a.replace(/MM/,9<this.getMonth()+1?(this.getMonth()+1).toString():"0"+(this.getMonth()+1));a=a.replace(/M/g,this.getMonth());a=a.replace(/w|W/g,"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(",")[this.getDay()]);a=a.replace(/dd|DD/,9<this.getDate()?this.getDate().toString():"0"+this.getDate());a=a.replace(/d|D/g,
this.getDate());a=a.replace(/hh|HH/,9<this.getHours()?this.getHours().toString():"0"+this.getHours());a=a.replace(/h|H/g,this.getHours());a=a.replace(/mm/,9<this.getMinutes()?this.getMinutes().toString():"0"+this.getMinutes());a=a.replace(/m/g,this.getMinutes());a=a.replace(/ss|SS/,9<this.getSeconds()?this.getSeconds().toString():"0"+this.getSeconds());return a=a.replace(/s|S/g,this.getSeconds())};
Date.prototype.DateAdd=function(a,b){switch(a){case "s":return new Date(Date.parse(this)+1E3*b);case "n":return new Date(Date.parse(this)+6E4*b);case "h":return new Date(Date.parse(this)+36E5*b);case "d":return new Date(Date.parse(this)+864E5*b);case "w":return new Date(Date.parse(this)+6048E5*b);case "q":return new Date(this.getFullYear(),this.getMonth()+3*b,this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds());case "m":return new Date(this.getFullYear(),this.getMonth()+b,this.getDate(),
this.getHours(),this.getMinutes(),this.getSeconds());case "y":return new Date(this.getFullYear()+b,this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds())}};
Date.prototype.DateDiff=function(a,b){"string"==typeof b&&(b=StringToDate(b));switch(a){case "s":return parseInt((b-this)/1E3);case "n":return parseInt((b-this)/6E4);case "h":return parseInt((b-this)/36E5);case "d":return parseInt((b-this)/864E5);case "w":return parseInt((b-this)/6048E5);case "m":return b.getMonth()+1+12*(b.getFullYear()-this.getFullYear())-(this.getMonth()+1);case "y":return b.getFullYear()-this.getFullYear()}};
Date.prototype.DatePart=function(a){var b="",c="\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(",");switch(a){case "y":b=this.getFullYear();break;case "m":b=this.getMonth()+1;break;case "d":b=this.getDate();break;case "w":b=c[this.getDay()];break;case "ww":b=this.WeekNumOfYear();break;case "h":b=this.getHours();break;case "n":b=this.getMinutes();break;case "s":b=this.getSeconds()}return b};Date.prototype.FirstDayOfDate=function(){var a=this.toArray();return new Date(a[0],a[1],1)};
Date.prototype.LastDayOfDate=function(){return this.FirstDayOfDate().DateAdd("m",1).DateAdd("d",-1)};Date.prototype.MaxDayOfDate=function(){return this.LastDayOfDate().DatePart("d")};Date.prototype.toArray=function(){var a=[];a[0]=this.getFullYear();a[1]=this.getMonth();a[2]=this.getDate();a[3]=this.getHours();a[4]=this.getMinutes();a[5]=this.getSeconds();return a};
function IsValidDate(a){var b=a.replace(/(^\s+|\s+$)/g,"");if(""==b)return!0;if(""==b.replace(/[\d]{ 4,4 }[\-/]{ 1 }[\d]{ 1,2 }[\-/]{ 1 }[\d]{ 1,2 }/g,"")){if(a=new Date(b.replace(/\-/g,"/")),b=b.split(/[-/:]/),b[0]!=a.getYear()||b[1]!=a.getMonth()+1||b[2]!=a.getDate())return!1}else return!1;return!0}
function CheckDateTime(a){a=a.match(/^(\d+)-(\d{ 1,2 })-(\d{ 1,2 }) (\d{ 1,2 }):(\d{ 1,2 }):(\d{ 1,2 })$/);if(null==a)return!1;a[2]-=1;var b=new Date(a[1],a[2],a[3],a[4],a[5],a[6]);return b.getFullYear()!=a[1]||b.getMonth()!=a[2]||b.getDate()!=a[3]||b.getHours()!=a[4]||b.getMinutes()!=a[5]||b.getSeconds()!=a[6]?!1:!0}function StringToDate(a){var b=Date.parse(a),b=new Date(b);isNaN(b)&&(a=a.split("-"),b=new Date(a[0],--a[1],a[2]));return b}
function set_date(a,b){var c=new Date,e=c.Format("yyyy-MM-dd"),c=c.DateAdd(a,b).Format("yyyy-MM-dd");$("#txtStartTime").datebox("setValue",c);$("#txtEndTime").datebox("setValue",e)}function get_game_list(a){$.ajax({url:"http://ggfx.syyx.cn/dict_game?r="+Math.random(),type:"get",dataType:"json",data:{IsAll:0},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(b){a(b.rows)}})}
function get_adclass_list(a){$.ajax({url:"http://ggfx.syyx.cn/ad_class_list?r="+Math.random(),type:"get",dataType:"json",data:{},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(b){a(b.rows)}})}
function get_admedia_list(a,b){$.ajax({url:"http://ggfx.syyx.cn/ad_media_list?r="+Math.random(),type:"get",dataType:"json",data:{ClassID:a},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){b(a.rows)}})}
function get_adad_list(a,b){$.ajax({url:"http://ggfx.syyx.cn/ad_ad_list?r="+Math.random(),type:"get",dataType:"json",data:{MediaID:a},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){b(a.rows)}})}
function get_adwebnumber_list(a,b){$.ajax({url:"http://ggfx.syyx.cn/ad_webnumber_list?r="+Math.random(),type:"get",dataType:"json",data:{ADID:a},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){b(a.rows)}})}var def_classid,def_mediaid,def_adid;
$(function(){def_classid=getParameterByName("ClassID");def_mediaid=getParameterByName("MediaID");def_adid=getParameterByName("ADID");def_date=getParameterByName("Date");set_date("d",0);""!=def_date&&($("#txtStartTime").datebox("setValue",def_date),$("#txtEndTime").datebox("setValue",def_date));init_game_list();init_ad_info();$("#ddlClass").change(function(){init_admedia_list(this.value)});$("#ddlMedia").change(function(){init_adad_list(this.value)});$("#ddlAd").change(function(){init_adwebnumber_list(this.value)})});
function init_ad_info(){init_adclass_list();init_admedia_list(def_classid);init_adad_list(def_mediaid);init_adwebnumber_list(def_adid)}function init_game_list(){$("#ddlGame").empty();get_game_list(function(a){$.each(a,function(a,c){$("#ddlGame").append("<option value='"+c.ID+"'>"+c.Title+"</option>")})})}
var init_adclass_list=function(){$("#ddlClass").empty();$("#ddlClass").append("<option value=0>\u6240\u6709</option");get_adclass_list(function(a){$.each(a,function(a,c){$("#ddlClass").append("<option value='"+c.ID+"'>"+c.ClassName+"</option>")});""!=def_classid&&$("#ddlClass").val(def_classid)})},init_admedia_list=function(a){$("#ddlMedia").empty();$("#ddlMedia").append("<option value=0>\u6240\u6709</option");""==a?init_adad_list(0):get_admedia_list(a,function(a){$.each(a,function(a,b){$("#ddlMedia").append("<option value='"+
b.ID+"'>"+b.MediaName+"</option>")});""!=def_mediaid&&$("#ddlMedia").val(def_mediaid)})},init_adad_list=function(a){$("#ddlAd").empty();$("#ddlAd").append("<option value=0>\u6240\u6709</option");""==a?init_adwebnumber_list(0):get_adad_list(a,function(a){$.each(a,function(a,b){$("#ddlAd").append("<option value='"+b.ID+"'>"+b.ADName+"</option>")});""!=def_adid&&$("#ddlAd").val(def_adid)})},init_adwebnumber_list=function(a){$("#ddlAdWebNumber").empty();$("#ddlAdWebNumber").append("<option value='0'>\u6240\u6709</option");
""!=a&&get_adwebnumber_list(a,function(a){$.each(a,function(a,b){$("#ddlAdWebNumber").append("<option value='"+b.ID+"'>"+b.ADWebNumber+"</option>")})})};$(function(){select_game_list();get_ad_info(0,0,0);$("#ddlSelectClass").change(function(){select_admedia_list(this.value,0)});$("#ddlSelectMedia").change(function(){select_adad_list(this.value,0)});$("#ddlSelectAd").change(function(){select_adwebnumber_list(this.value,0)})});
function get_ad_info(a,b,c){select_adclass_list(a);select_admedia_list(a,b);select_adad_list(b,c)}function select_game_list(){$("#ddlSelectGame").empty();get_game_list(function(a){$.each(a,function(a,c){$("#ddlSelectGame").append("<option value='"+c.ID+"'>"+c.Title+"</option>")})})}
var select_adclass_list=function(a){$("#ddlSelectClass").empty();$("#ddlSelectClass").append("<option value=0>\u8bf7\u9009\u62e9</option");get_adclass_list(function(b){$.each(b,function(a,b){$("#ddlSelectClass").append("<option value='"+b.ID+"'>"+b.ClassName+"</option>")});0!=a&&$("#ddlSelectClass").val(a)})},select_admedia_list=function(a,b){$("#ddlSelectMedia").empty();$("#ddlSelectMedia").append("<option value=0>\u8bf7\u9009\u62e9</option");0==a?select_adad_list(0,0):get_admedia_list(a,function(a){$.each(a,
function(a,b){$("#ddlSelectMedia").append("<option value='"+b.ID+"'>"+b.MediaName+"</option>")});0!=b&&$("#ddlSelectMedia").val(b)})},select_adad_list=function(a,b){$("#ddlSelectAd").empty();$("#ddlSelectAd").append("<option value=0>\u8bf7\u9009\u62e9</option");0!=a&&get_adad_list(a,function(a){$.each(a,function(a,b){$("#ddlSelectAd").append("<option value='"+b.ID+"'>"+b.ADName+"</option>")});0!=b&&$("#ddlSelectAd").val(b)})};var pageindex=1,pagesize=20;
$(function(){initDate(function(a,b){$("#ddlYear").val(a);$("#ddlMonth").val(b);createCalendar(a,b)});get_list();$("#ddlYear").change(function(){createCalendar()});$("#ddlMonth").change(function(){createCalendar()});$("#btnOK").click(function(){save_record()});$("#chkAll").change(function(){checkAllByName(this,"chkWeek")});$("#btnSearch").click(function(){get_list()});$("#btnView").click(function(){window.location.href="/ad_schedule_list"});$("#btnCancel").click(function(){cancel_record()});$(".color-picker").miniColors({letterCase:"uppercase",
change:function(){},open:function(){},close:function(){}})});function initDate(a){for(var b=(new Date).getFullYear(),c=0;10>c;c++){var e=b-3+c;b==e?$("<option value="+e+" selected>"+e+"</option>").appendTo($("#ddlYear")):$("<option value="+e+">"+e+"</option>").appendTo($("#ddlYear"))}e=(new Date).getMonth();for(c=1;12>=c;c++)$("#ddlMonth").append("<option value="+c+">"+c+"</option>");a(b,e+1)}
function createCalendar(a,b){$("#cc").empty();for(var c="\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(","),e=$("<table class='MonthView'><thead></thead><tbody></tbody></table>"),d=$("<tr></tr>").appendTo(e.find("thead")),f=0;f<c.length;f++)d.append("<th>"+c[f]+"</th>");a=$("#ddlYear").val();b=$("#ddlMonth").val();c=DateView(a,b-1);for(f=0;f<c.length;f++){var g=f/7;0==f%7&&(d=$("<tr id='tr_"+g+"'></tr>").appendTo(e.find("tbody")));"&nbsp;"!=c[f]?d.append("<td><input type='checkbox' id='chkDay"+
c[f]+"' name='chkWeek' onclick=\"changecolor(this.checked,'day"+c[f]+"')\"/>"+c[f]+"<span id='day"+c[f]+"'>&nbsp&nbsp</span></td>"):d.append("<td>"+c[f]+"</td>")}$("#cc").append(e);return 1}function DateView(a,b){var c=[],e=(new Date(a,b,1)).getDay(),d=(new Date(a,b+1,0)).getDate(),f=35;31==d&&4<e||30==d&&6==e?f=42:28==d&&0==e&&(f=28);for(var g=0;g<f;g++)c[g]="&nbsp;";for(g=0;g<d;g++)c[g+e]=g+1;return c}function clear_form(){$("#hidID").val(0);$("#txtPrice").val(0)}
function get_list(){clear_form();var a=$("#ddlClass").val(),b=$("#ddlMedia").val(),c=$("#ddlAd").val();$.ajax({url:"http://ggfx.syyx.cn/ad_schedule_page?r="+Math.random(),type:"get",dataType:"json",data:{ClassID:a,MediaID:b,ADID:c,PageIndex:pageindex,PageSize:pagesize},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){$("#tt tbody").find("tr.newrow").remove();$.each(a.rows,function(a,b){$("<tr class='newrow'></tr>").append("<td>"+b.ClassName+
"</td><td>"+b.MediaName+"</td><td>"+b.ADName+"</td><td>"+b.SYear+"-"+b.SMonth+"</td><td><a href='javascript:void(0)' onclick='show_data("+b.ID+","+b.SYear+","+b.SMonth+")'>\u9009\u62e9</a></td>").appendTo($("#tt tbody"))});$("#pp").pagination({total:a.total,pageSize:pagesize,showPageList:!1,showRefresh:!1,onSelectPage:function(a){pageindex=a;get_list()}})}})}
function show_data(a,b,c){$("#ddlYear").val(b);$("#ddlMonth").val(c);createCalendar(b,c);$.ajax({url:"http://ggfx.syyx.cn/ad_schedule_record?r="+Math.random(),type:"get",dataType:"json",data:{ID:a},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){if(0<a.rows.length){var a=a.rows[0],d=a.AdColor,f=(new Date(b,c,0)).getDate();$(".color-picker").miniColors("value",d);$("#hidID").val(a.ID);get_ad_info(a.ClassID,a.MediaID,a.ADID);$("#ddlModel").val(a.PriceType);
$("#txtPrice").val(a.AdPrice);1==a.Day1&&($("#chkDay1").attr("checked",!0),$("#day1").css("background",d));1==a.Day2&&($("#chkDay2").attr("checked",!0),$("#day2").css("background",d));1==a.Day3&&($("#chkDay3").attr("checked",!0),$("#day3").css("background",d));1==a.Day4&&($("#chkDay4").attr("checked",!0),$("#day4").css("background",d));1==a.Day5&&($("#chkDay5").attr("checked",!0),$("#day5").css("background",d));1==a.Day6&&($("#chkDay6").attr("checked",!0),$("#day6").css("background",d));1==a.Day7&&
($("#chkDay7").attr("checked",!0),$("#day7").css("background",d));1==a.Day8&&($("#chkDay8").attr("checked",!0),$("#day8").css("background",d));1==a.Day9&&($("#chkDay9").attr("checked",!0),$("#day9").css("background",d));1==a.Day10&&($("#chkDay10").attr("checked",!0),$("#day10").css("background",d));1==a.Day11&&($("#chkDay11").attr("checked",!0),$("#day11").css("background",d));1==a.Day12&&($("#chkDay12").attr("checked",!0),$("#day12").css("background",d));1==a.Day13&&($("#chkDay13").attr("checked",
!0),$("#day13").css("background",d));1==a.Day14&&($("#chkDay14").attr("checked",!0),$("#day14").css("background",d));1==a.Day15&&($("#chkDay15").attr("checked",!0),$("#day15").css("background",d));1==a.Day16&&($("#chkDay16").attr("checked",!0),$("#day16").css("background",d));1==a.Day17&&($("#chkDay17").attr("checked",!0),$("#day17").css("background",d));1==a.Day18&&($("#chkDay18").attr("checked",!0),$("#day18").css("background",d));1==a.Day19&&($("#chkDay19").attr("checked",!0),$("#day19").css("background",
d));1==a.Day20&&($("#chkDay20").attr("checked",!0),$("#day20").css("background",d));1==a.Day21&&($("#chkDay21").attr("checked",!0),$("#day21").css("background",d));1==a.Day22&&($("#chkDay22").attr("checked",!0),$("#day22").css("background",d));1==a.Day23&&($("#chkDay23").attr("checked",!0),$("#day23").css("background",d));1==a.Day24&&($("#chkDay24").attr("checked",!0),$("#day24").css("background",d));1==a.Day25&&($("#chkDay25").attr("checked",!0),$("#day25").css("background",d));1==a.Day26&&($("#chkDay26").attr("checked",
!0),$("#day26").css("background",d));1==a.Day27&&($("#chkDay27").attr("checked",!0),$("#day27").css("background",d));1==a.Day28&&($("#chkDay28").attr("checked",!0),$("#day28").css("background",d));29<=f&&1==a.Day29&&($("#chkDay29").attr("checked",!0),$("#day29").css("background",d));30<=f&&1==a.Day30&&($("#chkDay30").attr("checked",!0),$("#day30").css("background",d));31<=f&&1==a.Day31&&($("#chkDay31").attr("checked",!0),$("#day31").css("background",d))}}})}
function save_record(){var a=$("#ddlYear").val(),b=$("#ddlMonth").val(),a=(new Date(a,b,0)).getDate(),b=$("#hidID").val(),c=$("#ddlSelectAd").val();if(0==c)alert("\u8bf7\u9009\u62e9\u9700\u8981\u6392\u671f\u7684\u5e7f\u544a");else{var e=$("#ddlModel").val(),d=$("#txtPrice").val();if(""==d)alert("\u8bf7\u586b\u5199\u5e7f\u544a\u5355\u4ef7");else{var f=$("#txtColor").val(),g=$("#ddlYear").val(),k=$("#ddlMonth").val(),l="checked"==$("#chkDay1").attr("checked")?1:0,m="checked"==$("#chkDay2").attr("checked")?
1:0,n="checked"==$("#chkDay3").attr("checked")?1:0,o="checked"==$("#chkDay4").attr("checked")?1:0,p="checked"==$("#chkDay5").attr("checked")?1:0,q="checked"==$("#chkDay6").attr("checked")?1:0,r="checked"==$("#chkDay7").attr("checked")?1:0,s="checked"==$("#chkDay8").attr("checked")?1:0,t="checked"==$("#chkDay9").attr("checked")?1:0,u="checked"==$("#chkDay10").attr("checked")?1:0,v="checked"==$("#chkDay11").attr("checked")?1:0,w="checked"==$("#chkDay12").attr("checked")?1:0,x="checked"==$("#chkDay13").attr("checked")?
1:0,y="checked"==$("#chkDay14").attr("checked")?1:0,z="checked"==$("#chkDay15").attr("checked")?1:0,A="checked"==$("#chkDay16").attr("checked")?1:0,B="checked"==$("#chkDay17").attr("checked")?1:0,C="checked"==$("#chkDay18").attr("checked")?1:0,D="checked"==$("#chkDay19").attr("checked")?1:0,E="checked"==$("#chkDay20").attr("checked")?1:0,F="checked"==$("#chkDay21").attr("checked")?1:0,G="checked"==$("#chkDay22").attr("checked")?1:0,H="checked"==$("#chkDay23").attr("checked")?1:0,I="checked"==$("#chkDay24").attr("checked")?
1:0,J="checked"==$("#chkDay25").attr("checked")?1:0,K="checked"==$("#chkDay26").attr("checked")?1:0,L="checked"==$("#chkDay27").attr("checked")?1:0,M="checked"==$("#chkDay28").attr("checked")?1:0,h=0;29<=a&&(h="checked"==$("#chkDay29").attr("checked")?1:0);var i=0;30<=a&&(i="checked"==$("#chkDay30").attr("checked")?1:0);var j=0;31<=a&&(j="checked"==$("#chkDay31").attr("checked")?1:0);$.ajax({url:"http://ggfx.syyx.cn/ad_schedule_add?r="+Math.random(),type:"get",dataType:"json",data:{ID:b,ADID:c,PriceType:e,
AdPrice:d,AdColor:f,SYear:g,SMonth:k,Day1:l,Day2:m,Day3:n,Day4:o,Day5:p,Day6:q,Day7:r,Day8:s,Day9:t,Day10:u,Day11:v,Day12:w,Day13:x,Day14:y,Day15:z,Day16:A,Day17:B,Day18:C,Day19:D,Day20:E,Day21:F,Day22:G,Day23:H,Day24:I,Day25:J,Day26:K,Day27:L,Day28:M,Day29:h,Day30:i,Day31:j,IsOK:!0},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){0==a.retcode?(alert("\u5e7f\u544a\u6392\u671f\u8bbe\u5b9a\u6210\u529f"),get_list()):alert("\u5e7f\u544a\u6392\u671f\u8bbe\u5b9a\u5931\u8d25")}})}}}
function cancel_record(){var a=$("#hidID").val();$.ajax({url:"http://ggfx.syyx.cn/ad_schedule_delete?r="+Math.random(),type:"get",dataType:"json",data:{ID:a},beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},success:function(a){0==a.retcode?(alert("\u5e7f\u544a\u6392\u671f\u5df2\u53d6\u6d88"),get_list()):alert("\u5e7f\u544a\u6392\u671f\u53d6\u6d88\u5931\u8d25")}})}
function changecolor(a,b){var c=$("#txtColor").val();a?$("#"+b).css("background",c):$("#"+b).css("background","")};
