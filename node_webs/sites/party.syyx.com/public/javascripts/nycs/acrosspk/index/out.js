var enter,war,enter_data=!1,war_data=!1,check=0;function date2html(b){var a=b.length;6<a&&(a=6);for(var c="",e=0;e<a;e++)var g=b[e].AddDate.split("-"),c=c+("<a>"+g[0]+"\u5e74"+g[1]+"\u6708</a>");$("#time_box").html(c);dateevent()}function html2date(b){b=b.split("\u5e74");return b[0]+"-"+b[1].replace("\u6708","")}function date2serch(b){var a=b.split("-");return"?startdate="+b+"-1&enddate="+a[0]+"-"+(a[1]-0+1)+"-1"}
function dateevent(){$("#view_time span").eq(0).unbind("click");$("#view_time span").eq(0).click(function(){if(""!=$("#time_box").html()){$("#time_box").fadeIn("fast",function(){$(document).one("click",function(c){c.stopPropagation();$("#time_box").fadeOut("fast")})});for(var b=$("#time_box a").length,a=0;a<b;a++)$("#time_box a").eq(a).click(function(){$("#view_time span").eq(0).html()!=$(this).html()&&($("#view_time span").eq(0).html($(this).html()),$("#time_box").fadeOut("fast"),show_enter(html2date($(this).html())),
show_war(html2date($(this).html())))})}})}function cycle(b,a){var c=""==b?"":b[0].AddDate,e=""==a?"":a[0].AddDate;tab_event();if(c>e||""==e)$("#tab_charts span").eq(1).addClass("check_1"),$(".tbl_2").fadeIn("fast"),$(".tbl_1").css("display","none"),check=1,date2html(enter),show_war(c),show_enter(c);else if(c<=e||""==c)$("#tab_charts span").eq(0).addClass("check_0"),$(".tbl_2").css("display","none"),$(".tbl_1").fadeIn("fast"),check=0,date2html(war),show_war(e),show_enter(e)}
function show_enter(b){var a=b.split("-");$("#view_time span").eq(0).html(a[0]+"\u5e74"+a[1]+"\u6708");$.get("/nycs/acrosspk/enterlist"+date2serch(b),function(c){if(""!=c){enter_data=!0;1==check&&($(".tbl_3").css("display","none"),$(".tbl_2").fadeIn("fast"));var b=c.length,a=[0,0,0,0];$("#enter").html("");for(var d=0;d<b;d++){if(!(""==c[d].FirstGroupName||"undefined"==c[d].FirstGroupName||"null"==c[d].FirstGroupName)||!(""==c[d].SecondGroupName||"undefined"==c[d].SecondGroupName||"null"==c[d].SecondGroupName)){var f=
c[d].PKRound;a[f]==a[0]&&($("#enter").append('<tr><td></td><td class="t_title" rowspan="2"></td><td></td><td class="t_title" rowspan="2"></td><td></td><td class="t_title" rowspan="2"></td></tr><tr><td></td><td></td><td></td></tr>'),a[0]++);$("#enter td").eq(2*f-2+9*a[f]).html(c[d].FirstGroupName.replace(/undefined|null/,""));$("#enter td").eq(2*f-1+9*a[f]).html(c[d].ServerName.replace(/undefined|null/,""));$("#enter td").eq(f+5+9*a[f]).html(c[d].SecondGroupName.replace(/undefined|null/,""))}a[f]++}}else enter_data=
!1},"json")}
function show_war(b){var a=b.split("-");$("#view_time span").eq(0).html(a[0]+"\u5e74"+a[1]+"\u6708");$("#war_g span").html("");$("#war_s span").html("");$("#war_g .gold").html("");$("#war_s .gold").html("");$.get("/nycs/acrosspk/groupranklist"+date2serch(b),function(c){if(""!=c){war_data=!0;0==check&&($(".tbl_3").css("display","none"),$(".tbl_1").fadeIn("fast"));for(var a=c.length,b=0;b<a;b++){var d=c[b].PKRound-1;$("#war_g span").eq(d).html("("+c[b].ServerName.replace(/undefined|null/,"")+")");$("#war_g .gold").eq(d).html(c[b].GroupName.replace(/undefined|null/,
""))}}else war_data=!1},"json");$.get("/nycs/acrosspk/warlist"+date2serch(b),function(c){for(var b=c.length,a=0;a<b;a++){var d=c[a].PKRound;$("#war_s .gold").eq(d-1).html(c[a].ServerName.replace(/undefined|null/,""));$("#war_s span").eq(2*d-2).html(c[a].FirstGroupName.replace(/undefined|null/,""));$("#war_s span").eq(2*d-1).html(c[a].SecondGroupName.replace(/undefined|null/,""))}},"json")}
function tab_event(){$("#tab_charts span").eq(0).click(function(){check=0;$("#tab_charts span").eq(1).removeClass("check_1");$(this).addClass("check_0");$(".tbl_2").css("display","none");$(".tbl_3").css("display","none");!0==war_data?$(".tbl_1").fadeIn("fast"):$(".tbl_3").fadeIn("fast");date2html(war)});$("#tab_charts span").eq(1).click(function(){check=1;$("#tab_charts span").eq(0).removeClass("check_0");$(this).addClass("check_1");$(".tbl_1").css("display","none");$(".tbl_3").css("display","none");
!0==enter_data?$(".tbl_2").fadeIn("fast"):$(".tbl_3").fadeIn("fast");date2html(enter)})}
!function(){$("#tab_match a").eq(1).mouseout(function(){$("#tab_match a").eq(0).addClass("tab_0");$("#tab_match a").eq(1).removeClass()});$("#tab_match a").eq(1).mouseover(function(){$("#tab_match a").eq(1).addClass("tab_1");$("#tab_match a").eq(0).removeClass()});$.get("/nycs/acrosspk/entercycle",function(b){$.get("/nycs/acrosspk/warcycle",function(a){""==b&&""==a?($(".tbl_3").fadeIn("fast"),$("#view_time span").eq(0).html("\u6682\u65e0\u6570\u636e")):(enter=b,war=a,cycle(b,a))},"json")},"json");
$("a").attr("hidefocus","true")}();
