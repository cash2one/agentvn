_G_all_input_checks={empty:function(b,a){if(""==b)return a.err_info},length:function(b,a){if(a.options){for(var c in a.options)if(b.length==a.options[c])return;return a.err_info}a.min=a.min||0;a.max=a.max||Math.pow(2,32);if(b.length<a.min||b.length>a.max)return a.err_info},regex:function(b,a){if(!a.value.test(b))return a.err_info},equal:function(b,a){if("server"==a.side){var c=a.req.body[a.value];if(c!=b)return a.err_info}else if("session"==a.side){if(c=a.req.session[a.value],c!=b)return a.err_info}else if($("#"+
a.value).val()!=b)return a.err_info},notequal:function(b,a){if(a.options)for(var c in a.options)if(b==a.options[c])return a.err_info}};_G_check_request_data=function(b,a){for(var c in b.body)if(a[c]){var d=b.body[c],e=a[c].checks,g;for(g in e){var h=e[g].type,f=e[g];f.req=b;var i=_G_all_input_checks[h];if(!i)return f={},f[c]=h,f;f=i(d,f);if(void 0!=f)return f={},f[c]=h,f}}};
var input_config={background_highlight_class:"focus_in_inut",error_tag_class:"input_wrong",status_class:{ok:"check_result_right",error:"check_result_wrong",checking:"check_result_loading"}},captcha_dom,input_local_check_func=_G_all_input_checks;function input_highlight_background(b){b.addClass(input_config.background_highlight_class)}function input_recover_background(b){b.removeClass(input_config.background_highlight_class)}
function input_recover(b,a){var c=b.hasClass(input_config.error_tag_class),d=!0;void 0!=a.clearvalue&&(d=a.clearvalue);c&&(b.removeClass(input_config.error_tag_class),d&&b.val(""),(c=a.status_div_id)&&$("#"+c).attr("class",""))}function input_check_ok(b,a){var c=a.status_div_id;c&&$("#"+c).attr("class",input_config.status_class.ok)}
function input_check_error(b,a,c){b.addClass(input_config.error_tag_class);var d=a.status_div_id;d&&$("#"+d).attr("class",input_config.status_class.error);if(d=a.info_div_id)d="#"+d,$(d).is(":hidden")&&a.info_cover_input&&(b.hide(),$(d).show(),$(d).addClass(input_config.error_tag_class)),c&&($(d).is("input")?$(d).val(c):$(d).html(c))}
function input_local_getvalue(b,a){var c=[],d=0;switch(a.input_type){case "checkbox":case "radio":$("input[name="+a.name+"]:checked").each(function(){c[d]=$(this).val();d++});break;case "select":$("#"+a.input_id+" option:selected").each(function(){c[d]=$(this).val();d++});break;default:c=b.val()}return c}
function input_local_check(b,a){var c=input_local_getvalue(b,a),d;for(d in a.local_check){var e=a.local_check[d],e=(0,input_local_check_func[e.type])(c,e);if(void 0!==e)return input_check_error(b,a,e),!1}input_check_ok(b,a);return!0}
function input_remote_check(b,a){if(!a.remote_check)return!0;var c=input_local_getvalue(b,a),d=a.remote_check.url;$("#"+a.status_div_id).attr("class",input_config.status_class.checking);$.ajax({type:"GET",cache:!1,url:d,data:{v:c},dataType:"json",success:function(c){0==c.type?input_check_ok(b,a):input_check_error(b,a,a.remote_check[c.type+""])}})}function input_show_pic(b,a){get_captcha(captcha_dom);$("#"+a.pic_img.id).show()}
function input_pic_setting(b,a){var c="#"+a.input_id,d="#"+a.pic_img.id,e=a.pic_img.len||4;$(c).keyup(function(){$(c).val().length>=e&&input_local_check(b,a)&&input_remote_check(b,a)});$(d).click(function(){var b="#"+a.status_div_id;$(d).attr("src",a.pic_img.src+"?r="+Math.random());$(b).removeClass(input_config.status_class.error);$(c).val("")})}function input_info_cover_input_setting(b,a){var c=a.info_div_id;c&&$("#"+c).focus(function(){b.is(":hidden")&&($(this).hide(),b.show(),b.focus())})}
function input_focus(b,a){get_captcha(captcha_dom);a.pic_img&&input_show_pic(b,a);input_highlight_background(b);input_recover(b,a)}function input_blur(b,a){input_recover_background(b);a.pic_img||($("#"+a.info_div_id).html(""),input_local_check(b,a)&&input_remote_check(b,a))}
function input_setting(b){var a=$("#"+b.input_id);a.val("");switch(b.input_type){case "checkbox":case "radio":$("input[name="+b.name+"]").each(function(){$(this).click(function(){input_focus(a,b)});$(this).click(function(){input_blur(a,b)})});break;default:a.focus(function(){input_focus(a,b)}),a.blur(function(){input_blur(a,b)})}b.pic_img&&input_pic_setting(a,b);b.info_cover_input&&input_info_cover_input_setting(a,b)}
function input_setting_inputs(b){for(var a in b)b[a].pic_img&&(captcha_dom=b[a]),input_setting(b[a])}function input_get_inputs_value(b){var a=!1,c;for(c in b){var d=b[c],e=d.name,d=input_local_getvalue($("#"+d.input_id),d),a=a||{};a[e]=d}return a}function input_local_check_inputs(b){var a=!0,c;for(c in b){var d=b[c];input_local_check($("#"+d.input_id),d)||(a=!1)}return a}function input_status_check(b){var a=!0,c;for(c in b)if(!1==check_unit_status(b[c])){a=!1;break}return a}
function get_captcha(b){if(b){var a="#"+b.pic_img.id;$(a).attr("src")||$(a).attr("src",b.pic_img.src+"?r="+Math.random())}}function check_unit_status(b){var a="#"+b.status_div_id;if($(a).hasClass(input_config.status_class.ok))return!0;if(!b.pic_img)return!1;$("#"+b.input_id).val();b=$(a).hasClass(input_config.status_class.error);a=$(a).hasClass(input_config.status_class.checking);return b||a?!1:!0}
function default_set(){$("#login_out").click(function(){$.get("/login_out?r="+Math.random(),function(){document.location.reload()})});$("#map2").click(function(){$.get("/check_user_login?r="+Math.random(),function(b){b.login?document.location="http://party.syyx.com/nycs/sing/uploadsing.html#tp":login()})});$("#topcy").click(function(){$.get("/check_user_login?r="+Math.random(),function(b){b.login?document.location="http://party.syyx.com/nycs/sing/uploadsing.html#tp":login()})});$(".div_close").click(login_close);
$.get("/check_user_login?r="+Math.random(),function(b){b.login&&($("#login_a").show(),$("#user_name").html(b.UserAccount))})}function vote(b){var a=document.documentElement.scrollTop||document.body.scrollTop;$("#iframe").attr("src","/nycs/sing/vote.html?id="+b);$("#popup_bg").css("display","block");$("#div_login").css("top",a+80);$("#div_login").css("display","block");$("html").scrollTop($("html").scrollTop()+1);$("body").scrollTop($("body").scrollTop()+1)}
function login_close(){$("#div_login").css("display","none");$("#popup_bg").css("display","none")}function login(){var b=document.documentElement.scrollTop||document.body.scrollTop;$("#iframe").attr("src","/nycs/sing/login.html?type=up");$("#popup_bg").css("display","block");$("#div_login").css("top",b+80);$("#div_login").css("display","block");$("html").scrollTop($("html").scrollTop()+1);$("body").scrollTop($("body").scrollTop()+1)};var login_input_data=[{name:"Nickname",input_id:"txtNickname",info_div_id:"loginerr",clearvalue:!1,local_check:[{type:"empty",err_info:"\u8bf7\u8f93\u5165\u6635\u79f0"},{type:"length",min:2,max:20,err_info:"\u6635\u79f0\u957f\u5ea6\u5fc5\u987b2-20\u4f4d"}]},{name:"phone",input_id:"txtPhone",info_div_id:"loginerr",clearvalue:!1,local_check:[{type:"empty",err_info:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u7801"},{type:"regex",value:/^[0-9]{11}$/,err_info:"\u624b\u673a\u53f7\u7801\u53ea\u80fd\u662f11\u4f4d\u6570\u5b57"}]},
{name:"content",input_id:"txtContent",info_div_id:"loginerr",clearvalue:!1,local_check:[{type:"length",min:0,max:18,err_info:"\u62c9\u7968\u5ba3\u8a00\u4e0d\u80fd\u8d85\u8fc718\u5b57"}]},{name:"txtFile",input_id:"txtFile",info_div_id:"loginerr",clearvalue:!1,local_check:[{type:"empty",err_info:"\u8bf7\u9009\u62e9\u4e0a\u4f20\u4f5c\u54c1"}]},{name:"mp3url",input_id:"mp3url",info_div_id:"loginerr",clearvalue:!1,local_check:[{type:"empty",err_info:"\u8bf7\u9009\u62e9\u4e0a\u4f20\u4f5c\u54c1"}]}];
$(function(){$("#map2").addClass("map2hover");$("#iframe1").attr("src","/nycs/sing/uploadmp3.html?r="+Math.random());default_set();$.get("/check_user_login?r="+Math.random(),function(b){b.login?(page_load(),$.get("/nycs/sing/get_myinfo?UserID="+b.UserID+"&r="+Math.random(),function(a){if(0<a.length){if(!a[0].IsCheck){$("#uploadmp3").html("");$("#uploadok").show();return}if(a[0].IsCheck&&a[0].IsPass&&!a[0].IsDelete){$("#uploadmp3").html("");$("#mylink").attr("href","/nycs/sing/singshow.html?id="+a[0].ID+
"#tp");$("#uploadone").show();return}if(a[0].IsCheck&&(!a[0].IsPass||a[0].IsDelete)){$("#uploadmp3").hide();$("#upload2").show();return}}$("#singdiv").show();$("#uploadmp3").show()})):document.location="http://party.syyx.com/nycs/sing/index.html"},"json")});function state_up(){$("#loginerr").html("<img src='http://r.syyx.com/party/nycs/sing/loading.gif' /><span>\u4f5c\u54c1\u4e0a\u4f20\u4e2d</span>")}
function state_clear(b){b?$("#loginerr").html("\u4f5c\u54c1\u683c\u5f0f\u4e3aMP3\u683c\u5f0f\u97f3\u9891\uff0c\u4e0d\u5f97\u5927\u4e8e5M"):$("#loginerr").html("")}
function page_load(){input_setting_inputs(login_input_data);$("#txtContent").val("\u652f\u6301Jolin\uff0c\u652f\u6301\u300a\u8bfa\u4e9a\u4f20\u8bf4\u300b");$("#txtContent").focus(function(){"\u652f\u6301Jolin\uff0c\u652f\u6301\u300a\u8bfa\u4e9a\u4f20\u8bf4\u300b"==$("#txtContent").val()&&$("#txtContent").val("")});$("#txtContent").blur(function(){""==$("#txtContent").val()&&$("#txtContent").val("\u652f\u6301Jolin\uff0c\u652f\u6301\u300a\u8bfa\u4e9a\u4f20\u8bf4\u300b")});$("#chkupload").click(function(b){account_register_request();
b.preventDefault()});$("#loginfrom").keypress(function(b){13==b.which&&(account_register_request(),b.preventDefault())});$("#fake_1").val("");$("#txtFile").change(function(){$("#fake_1").val($(this).val())});$("#reupload").click(function(){$("#uploadmp3").show();$("#upload2").hide()})}
function account_register_request(){var b=input_local_check_inputs(login_input_data);if(b&&(b=input_get_inputs_value(login_input_data)))b.r=Math.random(),$.post("/nycs/sing/savesing",b,function(a){"notlogin"==a?$("#loginerr").html("\u8bf7\u5148\u767b\u5f55!"):a.err?-1==a.ret||-2==a.ret?$("#loginerr").html("\u8bf7\u4e0d\u8981\u91cd\u590d\u63d0\u4ea4!"):$("#loginerr").html(a.ret):($("#loginerr").html("\u4fdd\u5b58\u6210\u529f!"),$("#uploadmp3").html(""),$("#uploadok").show())})}
function get_upstate(b,a){"success"==b&&$("#mp3url").val(a)};
